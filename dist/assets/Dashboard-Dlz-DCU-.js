import{j as t}from"./ui-CMGlPv8M.js";import{d as x,r as h}from"./router-02yfTqxa.js";import{A as b,Q as w,U as j,a as u,b as p,c as g,e as f,d as v}from"./index-DGiQKbnC.js";import{D as y}from"./dollar-sign-CYcO9sIf.js";import{T as N}from"./trending-up-DL-k5KbV.js";import{A as $}from"./activity-B_LWE1x-.js";import"./vendor-Dazix4UH.js";class k{baseUrl="https://api.akodefy.com/api";async makeRequest(e,a={}){const o=`${this.baseUrl}${e}`,i={headers:{"Content-Type":"application/json",...a.headers},...a},n=b.getToken();n&&(i.headers={...i.headers,Authorization:`Bearer ${n}`});try{const s=await fetch(o,i);if(!s.ok){let r;try{r=await s.json()}catch{r={success:!1,message:`HTTP ${s.status}: ${s.statusText}`}}throw new Error(r&&r.message||"An error occurred")}const d=await s.json();if(d==null)throw new Error("Received null or undefined response from server");return d}catch(s){throw console.error("API request failed:",s),s}}async getDashboardData(){try{const e=await this.makeRequest("/dashboard");if(!e||typeof e!="object")throw new Error("Invalid response format");return e}catch(e){return console.error("Failed to fetch dashboard data:",e),{success:!0,data:{stats:{totalUsers:0,totalProperties:0,totalRevenue:0,activeListings:0,newUsersThisMonth:0,newPropertiesThisMonth:0,revenueThisMonth:0,engagementRate:0},recentActivities:[]}}}}formatRevenue(e){return e>=1e7?`₹${(e/1e7).toFixed(1)} Cr`:e>=1e5?`₹${(e/1e5).toFixed(1)} Lac`:`₹${e.toLocaleString("en-IN")}`}formatPercentageChange(e,a){if(a===0)return"+0%";const o=(e-a)/a*100;return`${o>=0?"+":""}${o.toFixed(1)}%`}formatActivityDescription(e){switch(e.type){case"user_registered":return`New user registered: ${e.metadata?.email||"Unknown"}`;case"property_listed":return`New property listed: ${e.metadata?.title||"Unknown"}`;case"property_sold":return`Property sold: ${e.metadata?.title||"Unknown"}`;case"property_rented":return`Property rented: ${e.metadata?.title||"Unknown"}`;case"inquiry_received":return`New inquiry received for: ${e.metadata?.propertyTitle||"Unknown"}`;case"subscription_purchased":return`Subscription purchased: ${e.metadata?.planName||"Unknown"} - ₹${e.metadata?.amount||0}`;default:return e.description}}formatTimestamp(e){const a=new Date,o=new Date(e),i=a.getTime()-o.getTime(),n=Math.floor(i/(1e3*60*60)),s=Math.floor(n/24);return n<1?"Just now":n<24?`${n} hour${n>1?"s":""} ago`:s<7?`${s} day${s>1?"s":""} ago`:o.toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}}const m=new k,_=()=>{const l=x(),[e,a]=h.useState(null),[o,i]=h.useState([]),[n,s]=h.useState(!0);if(h.useEffect(()=>{(async()=>{try{const c=await m.getDashboardData();c.success&&(a(c.data.stats),i(c.data.recentActivities))}catch(c){console.error("Failed to fetch dashboard data:",c)}finally{s(!1)}})()},[]),n)return t.jsxs("div",{className:"flex justify-center items-center py-12",children:[t.jsx(w,{className:"h-8 w-8 animate-spin"}),t.jsx("span",{className:"ml-2 text-lg",children:"Loading dashboard..."})]});if(!e)return t.jsx("div",{className:"text-center py-12",children:t.jsx("p",{className:"text-lg text-muted-foreground",children:"Failed to load dashboard data."})});const d=[{title:"Total Revenue",value:m.formatRevenue(e.totalRevenue),change:`${e.revenueThisMonth>0?"+":""}${m.formatRevenue(e.revenueThisMonth)} this month`,icon:y,color:"text-emerald-500 dark:text-emerald-400",bgColor:"bg-emerald-500/10",onClick:()=>l("/admin/revenue-details")},{title:"Total Users",value:e.totalUsers.toLocaleString(),change:`+${e.newUsersThisMonth} this month`,icon:j,color:"text-blue-500 dark:text-blue-400",bgColor:"bg-blue-500/10",onClick:()=>l("/admin/users-details")},{title:"Total Properties",value:e.totalProperties.toLocaleString(),change:`+${e.newPropertiesThisMonth} this month`,icon:N,color:"text-accent",bgColor:"bg-accent/10",onClick:()=>l("/admin/properties-details")},{title:"Engagement Rate",value:`${e.engagementRate}%`,change:"Favorites per property",icon:$,color:"text-primary",bgColor:"bg-primary/10",onClick:()=>l("/admin/engagement-details")}];return t.jsxs("div",{className:"space-y-6 animate-fade-in",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),t.jsx("p",{className:"text-muted-foreground mt-1",children:"Welcome back! Here's an overview of your metrics."})]}),t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:d.map(r=>{const c=r.icon;return t.jsxs(u,{className:`hover:shadow-lg transition-all ${r.onClick?"cursor-pointer hover:scale-105":""}`,onClick:r.onClick,children:[t.jsxs(p,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[t.jsx(g,{className:"text-sm font-medium",children:r.title}),t.jsx("div",{className:`p-2 rounded-lg ${r.bgColor}`,children:t.jsx(c,{className:`h-4 w-4 ${r.color}`})})]}),t.jsxs(f,{children:[t.jsx("div",{className:"text-2xl font-bold",children:r.value}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.change})]})]},r.title)})}),t.jsxs(u,{children:[t.jsxs(p,{children:[t.jsx(g,{children:"Recent Activity"}),t.jsx(v,{children:"Latest platform activities"})]}),t.jsx(f,{children:t.jsx("div",{className:"space-y-4",children:o.length===0?t.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No recent activities"}):o.map(r=>t.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b last:border-0 last:pb-0",children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${r.type==="user_registered"?"bg-blue-500":r.type==="property_listed"?"bg-green-500":r.type==="property_sold"?"bg-emerald-500":r.type==="property_rented"?"bg-purple-500":r.type==="subscription_purchased"?"bg-yellow-500":"bg-primary"}`}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-medium",children:m.formatActivityDescription(r)}),t.jsx("p",{className:"text-xs text-muted-foreground",children:m.formatTimestamp(r.timestamp)})]})]},r._id))})})]})]})};export{_ as default};
