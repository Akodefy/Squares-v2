import{j as e}from"./ui-CMGlPv8M.js";import{e as I,d as z,r as u}from"./router-02yfTqxa.js";import{a1 as B,u as V,Q as q,f as m,D as b,a as N,b as y,c as C,d as S,e as w,L as x,I as R,T as U,a5 as H,a6 as Q,a7 as h,az as P,au as G,B as J}from"./index-DGiQKbnC.js";import{C as K}from"./checkbox-Cs4lqKpa.js";import{r as k}from"./roleService-CM7r2mAC.js";import{I as M}from"./info-BqWbPkJM.js";import"./vendor-Dazix4UH.js";const ee=()=>{const{id:d}=I(),n=z(),{toast:p}=B(),{isSuperAdmin:c}=V(),[s,i]=u.useState(null),[A,f]=u.useState(!0),[g,v]=u.useState(!1),L=["admin","subadmin","vendor","customer"];u.useEffect(()=>{(async()=>{if(d)try{f(!0);const t=(await k.getRole(d)).data.role;i({...t,pages:t.pages||[]})}catch(l){console.error("Failed to fetch role:",l),p({title:"Error",description:"Failed to load role data.",variant:"destructive"}),n("/admin/roles")}finally{f(!1)}})()},[d,n,p]);const T=async a=>{if(a.preventDefault(),!(!s||!d)){if(!s.pages||s.pages.length===0){p({title:"Validation Error",description:"Please select at least one page",variant:"destructive"});return}try{v(!0),await k.updateRole(d,{name:s.name,description:s.description,pages:s.pages,isActive:s.isActive,level:s.level}),n("/admin/roles")}catch(l){console.error("Failed to update role:",l)}finally{v(!1)}}},F=a=>{if(!s||s.isSystemRole&&!c)return;const l=s.pages||[],t=l.includes(a)?l.filter(o=>o!==a):[...l,a];i({...s,pages:t})},D=a=>{if(!s||s.isSystemRole&&!c)return;const l=P(a),t=s.pages||[];if(l.every(r=>t.includes(r.id)))i({...s,pages:t.filter(r=>!l.some(j=>j.id===r))});else{const r=l.map(j=>j.id);i({...s,pages:[...new Set([...t,...r])]})}},E=({pages:a})=>{if(!s)return null;const l=s.pages||[];return e.jsx("div",{className:"space-y-2",children:a.map(t=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsx(K,{id:t.id,checked:l.includes(t.id),onCheckedChange:()=>F(t.id),disabled:s.isSystemRole&&!c}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs(x,{htmlFor:t.id,className:"flex items-center gap-2 cursor-pointer font-medium",children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label,t.subLabel&&e.jsx(J,{variant:"outline",className:"text-xs",children:t.subLabel})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:t.path})]})]},t.id))})};return A?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(q,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading role..."})]}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>n("/admin/roles"),children:e.jsx(b,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Edit Role: ",s.name]}),e.jsx("p",{className:"text-muted-foreground",children:"Update role details and page access"})]})]}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs(N,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Basic Information"}),e.jsx(S,{children:"Core details about this role"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"name",children:["Role Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(R,{id:"name",value:s.name,onChange:a=>i({...s,name:a.target.value}),disabled:s.isSystemRole&&!c,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"level",children:"Access Level (1-10)"}),e.jsx(R,{id:"level",type:"number",min:"1",max:"10",value:s.level,onChange:a=>i({...s,level:parseInt(a.target.value)||1}),disabled:s.isSystemRole&&!c})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"description",children:"Description"}),e.jsx(U,{id:"description",value:s.description,onChange:a=>i({...s,description:a.target.value}),rows:3})]})]})]}),e.jsxs(N,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Page Access"}),e.jsx(S,{children:"Select which pages this role can access"})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg flex gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsxs("p",{className:"font-medium mb-1",children:["Selected: ",s.pages?.length||0," pages"]}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:"Choose pages from different portal categories. Users with this role will only see and access the selected pages."})]})]}),e.jsxs(H,{defaultValue:"admin",className:"w-full",children:[e.jsxs(Q,{className:"grid w-full grid-cols-4",children:[e.jsx(h,{value:"admin",children:"Super Admin"}),e.jsx(h,{value:"subadmin",children:"Sub Admin"}),e.jsx(h,{value:"vendor",children:"Vendor"}),e.jsx(h,{value:"customer",children:"Customer"})]}),L.map(a=>{const l=P(a),t=s.pages||[],o=l.filter(r=>t.includes(r.id)).length;return e.jsxs(G,{value:a,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-accent/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium capitalize",children:[a," Pages"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[o," of ",l.length," selected"]})]}),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>D(a),disabled:s.isSystemRole&&!c,children:o===l.length?"Deselect All":"Select All"})]}),e.jsx(E,{pages:l})]},a)})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(m,{type:"submit",disabled:g,children:g?"Saving...":"Save Changes"}),e.jsx(m,{type:"button",variant:"outline",onClick:()=>n("/admin/roles"),disabled:g,children:"Cancel"})]})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>n("/admin/roles"),children:e.jsx(b,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Role Not Found"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"The requested role could not be found."})]})]})})};export{ee as default};
