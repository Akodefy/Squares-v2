import{j as e}from"./ui-DHQhougw.js";import{e as s,d as a,r as l}from"./router-Bi51YGN-.js";import{z as i,a0 as t,u as n,D as r,f as c,A as d,a as o,b as m,c as x,d as h,e as u,L as p,I as j,T as g,a4 as f,a5 as v,a6 as N,ap as b,ak as y,B as S}from"./index-B9LUr8LQ.js";import{C as k}from"./checkbox-DTV8WIv5.js";import{r as w}from"./roleService-cq0hMjvd.js";import"./vendor-eVk5PToZ.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=i("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),R=()=>{const{id:i}=s(),R=a(),{toast:A}=t(),{isSuperAdmin:F}=n(),[z,L]=l.useState(null),[D,E]=l.useState(!0),[I,q]=l.useState(!1);l.useEffect(()=>{(async()=>{if(i)try{E(!0);const e=(await w.getRole(i)).data.role;L({...e,pages:e.pages||[]})}catch(e){A({title:"Error",description:"Failed to load role data.",variant:"destructive"}),R("/admin/roles")}finally{E(!1)}})()},[i,R,A]);const P=({pages:s})=>{if(!z)return null;const a=z.pages||[];return e.jsx("div",{className:"space-y-2",children:s.map(s=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsx(k,{id:s.id,checked:a.includes(s.id),onCheckedChange:()=>(e=>{if(!z)return;if(z.isSystemRole&&!F)return;const s=z.pages||[],a=s.includes(e)?s.filter(s=>s!==e):[...s,e];L({...z,pages:a})})(s.id),disabled:z.isSystemRole&&!F}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs(p,{htmlFor:s.id,className:"flex items-center gap-2 cursor-pointer font-medium",children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label,s.subLabel&&e.jsx(S,{variant:"outline",className:"text-xs",children:s.subLabel})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:s.path})]})]},s.id))})};return D?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(r,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading role..."})]}):z?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>R("/admin/roles"),children:e.jsx(d,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Edit Role: ",z.name]}),e.jsx("p",{className:"text-muted-foreground",children:"Update role details and page access"})]})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),z&&i)if(z.pages&&0!==z.pages.length)try{q(!0),await w.updateRole(i,{name:z.name,description:z.description,pages:z.pages,isActive:z.isActive,level:z.level}),R("/admin/roles")}catch(s){}finally{q(!1)}else A({title:"Validation Error",description:"Please select at least one page",variant:"destructive"})},className:"space-y-6",children:[e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Basic Information"}),e.jsx(h,{children:"Core details about this role"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"name",children:["Role Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(j,{id:"name",value:z.name,onChange:e=>L({...z,name:e.target.value}),disabled:z.isSystemRole&&!F,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"level",children:"Access Level (1-10)"}),e.jsx(j,{id:"level",type:"number",min:"1",max:"10",value:z.level,onChange:e=>L({...z,level:parseInt(e.target.value)||1}),disabled:z.isSystemRole&&!F})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"description",children:"Description"}),e.jsx(g,{id:"description",value:z.description,onChange:e=>L({...z,description:e.target.value}),rows:3})]})]})]}),e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Page Access"}),e.jsx(h,{children:"Select which pages this role can access"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg flex gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsxs("p",{className:"font-medium mb-1",children:["Selected: ",z.pages?.length||0," pages"]}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300",children:"Choose pages from different portal categories. Users with this role will only see and access the selected pages."})]})]}),e.jsxs(f,{defaultValue:"admin",className:"w-full",children:[e.jsxs(v,{className:"grid w-full grid-cols-4",children:[e.jsx(N,{value:"admin",children:"Super Admin"}),e.jsx(N,{value:"subadmin",children:"Sub Admin"}),e.jsx(N,{value:"vendor",children:"Vendor"}),e.jsx(N,{value:"customer",children:"Customer"})]}),["admin","subadmin","vendor","customer"].map(s=>{const a=b(s),l=z.pages||[],i=a.filter(e=>l.includes(e.id)).length;return e.jsxs(y,{value:s,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-accent/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium capitalize",children:[s," Pages"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i," of ",a.length," selected"]})]}),e.jsx(c,{type:"button",variant:"outline",size:"sm",onClick:()=>(e=>{if(!z)return;if(z.isSystemRole&&!F)return;const s=b(e),a=z.pages||[];if(s.every(e=>a.includes(e.id)))L({...z,pages:a.filter(e=>!s.some(s=>s.id===e))});else{const e=s.map(e=>e.id);L({...z,pages:[...new Set([...a,...e])]})}})(s),disabled:z.isSystemRole&&!F,children:i===a.length?"Deselect All":"Select All"})]}),e.jsx(P,{pages:a})]},s)})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(c,{type:"submit",disabled:I,children:I?"Saving...":"Save Changes"}),e.jsx(c,{type:"button",variant:"outline",onClick:()=>R("/admin/roles"),disabled:I,children:"Cancel"})]})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>R("/admin/roles"),children:e.jsx(d,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Role Not Found"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"The requested role could not be found."})]})]})})};export{R as default};
