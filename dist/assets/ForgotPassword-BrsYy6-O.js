import{j as e}from"./ui-CMGlPv8M.js";import{d as D,r as a,L as Y}from"./router-02yfTqxa.js";import{G as $,N as _,a as G,e as J,L as j,M as X,I as O,f as C,D as z,E as B,F as U,t as s}from"./index-DGiQKbnC.js";import{I as V,a as W,b as p}from"./input-otp-DDLYfRz_.js";import{L as E}from"./lock-aqfC1785.js";import{E as Z}from"./eye-off-CFJDzV2J.js";import"./vendor-Dazix4UH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=$("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ie=()=>{const R=D(),[i,d]=a.useState("email"),[o,k]=a.useState(""),[f,P]=a.useState(""),[l,N]=a.useState(""),[b,T]=a.useState(""),[w,I]=a.useState(!1),[x,m]=a.useState(!1),[L,M]=a.useState(10),[S,v]=a.useState(!1),[h,y]=a.useState(0);a.useEffect(()=>{if(h>0){const t=setTimeout(()=>{y(h-1)},1e3);return()=>clearTimeout(t)}else v(!0)},[h]);const F=async t=>{if(t.preventDefault(),!o){s({title:"Email Required",description:"Please enter your email address",variant:"destructive"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)){s({title:"Invalid Email",description:"Please enter a valid email address",variant:"destructive"});return}m(!0);try{const r=await fetch("https://api.akodefy.com/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o})}),n=await r.json();r.ok&&n.success?(d("otp"),n.expiryMinutes&&M(n.expiryMinutes),y(120),v(!1),s({title:"OTP Sent!",description:"Check your email for the password reset code."})):r.status===429?s({title:"Too Many Requests",description:n.message||"Please wait before requesting another OTP",variant:"destructive"}):n.message&&!n.message.includes("exists")?s({title:"Error",description:n.message,variant:"destructive"}):(d("otp"),s({title:"Check Your Email",description:"If an account exists with this email, you will receive a password reset code."}))}catch(r){console.error("Request OTP error:",r),s({title:"Connection Error",description:"Failed to connect to the server. Please try again.",variant:"destructive"})}finally{m(!1)}},q=async t=>{if(t.preventDefault(),!f||!l||!b){s({title:"All Fields Required",description:"Please fill in all fields",variant:"destructive"});return}if(f.length!==6){s({title:"Invalid OTP",description:"Please enter the complete 6-digit OTP",variant:"destructive"});return}if(l!==b){s({title:"Passwords Don't Match",description:"Please make sure your passwords match",variant:"destructive"});return}if(l.length<8){s({title:"Password Too Short",description:"Password must be at least 8 characters",variant:"destructive"});return}const u=/[A-Z]/.test(l),r=/[a-z]/.test(l),n=/[0-9]/.test(l);if(!u||!r||!n){s({title:"Weak Password",description:"Password must contain uppercase, lowercase, and numbers",variant:"destructive"});return}m(!0);try{const g=await fetch("https://api.akodefy.com/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,otp:f,newPassword:l})}),c=await g.json();g.ok&&c.success?(d("success"),s({title:"Password Reset!",description:"Your password has been successfully reset."}),P(""),N(""),T("")):c.error==="OTP_EXPIRED"?(s({title:"OTP Expired",description:"Your OTP has expired. Please request a new one.",variant:"destructive"}),d("email")):c.error==="INVALID_OTP"?s({title:"Invalid OTP",description:c.attemptsLeft?`Invalid OTP. ${c.attemptsLeft} attempts remaining.`:"Invalid OTP. Please try again.",variant:"destructive"}):c.error==="MAX_ATTEMPTS_EXCEEDED"?(s({title:"Too Many Attempts",description:"Maximum attempts exceeded. Please request a new OTP.",variant:"destructive"}),d("email")):s({title:"Reset Failed",description:c.message||"Invalid OTP or password",variant:"destructive"})}catch(g){console.error("Reset password error:",g),s({title:"Connection Error",description:"Failed to reset password. Please try again.",variant:"destructive"})}finally{m(!1)}},A=async()=>{if(S){m(!0);try{const t=await fetch("https://api.akodefy.com/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o})}),u=await t.json();if(t.ok&&u.success)y(120),v(!1),s({title:"OTP Resent!",description:"A new OTP has been sent to your email."});else if(t.status===429){const r=u.remainingSeconds||120;y(r),v(!1),s({title:"Please Wait",description:`You can request a new OTP in ${r} seconds`,variant:"destructive"})}else s({title:"Error",description:u.message||"Failed to resend OTP",variant:"destructive"})}catch(t){console.error("Resend OTP error:",t),s({title:"Connection Error",description:"Failed to resend OTP. Please try again.",variant:"destructive"})}finally{m(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(_,{}),e.jsx("main",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:[i==="email"&&"Forgot Password",i==="otp"&&"Reset Your Password",i==="success"&&"Password Reset Successful"]}),e.jsxs("p",{className:"text-muted-foreground",children:[i==="email"&&"Enter your email to receive a reset code",i==="otp"&&"Enter the OTP sent to your email",i==="success"&&"You can now login with your new password"]})]}),e.jsx(G,{children:e.jsxs(J,{className:"p-6",children:[i==="email"&&e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"email",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(O,{id:"email",type:"email",placeholder:"you@example.com",value:o,onChange:t=>k(t.target.value),className:"pl-10",required:!0})]})]}),e.jsx(C,{type:"submit",className:"w-full",disabled:x,children:x?"Sending...":"Send Reset Code"}),e.jsx("div",{className:"text-center",children:e.jsxs(Y,{to:"/login",className:"inline-flex items-center text-sm text-primary hover:underline",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Back to Login"]})})]}),i==="otp"&&e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:"text-base",children:"Verification Code"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Enter the 6-digit code sent to ",o]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(V,{maxLength:6,value:f,onChange:t=>P(t),children:e.jsxs(W,{children:[e.jsx(p,{index:0}),e.jsx(p,{index:1}),e.jsx(p,{index:2}),e.jsx(p,{index:3}),e.jsx(p,{index:4}),e.jsx(p,{index:5})]})})}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["Code expires in ",L," minutes"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"newPassword",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(O,{id:"newPassword",type:w?"text":"password",placeholder:"Enter new password",value:l,onChange:t=>N(t.target.value),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>I(!w),className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:w?e.jsx(Z,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(B,{className:"h-5 w-5 text-muted-foreground"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Must be at least 8 characters with uppercase, lowercase, and numbers"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(O,{id:"confirmPassword",type:w?"text":"password",placeholder:"Confirm new password",value:b,onChange:t=>T(t.target.value),className:"pl-10",required:!0})]})]}),e.jsx(C,{type:"submit",className:"w-full",disabled:x,children:x?"Resetting...":"Reset Password"}),e.jsxs("div",{className:"text-center space-y-2",children:[S?e.jsx("button",{type:"button",onClick:A,className:"text-sm text-primary hover:underline",disabled:x,children:"Didn't receive code? Resend OTP"}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resend OTP in ",Math.floor(h/60),":",(h%60).toString().padStart(2,"0")]}),e.jsx("button",{type:"button",onClick:()=>{d("email"),P(""),N(""),T("")},className:"block w-full text-sm text-muted-foreground hover:text-primary",children:"Use a different email"})]})]}),i==="success"&&e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(H,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Password Reset Successful!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your password has been successfully changed. You can now sign in with your new password."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(C,{onClick:()=>R("/login"),className:"w-full",children:"Go to Login"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["A confirmation email has been sent to ",o]})]})]})]})})]})}),e.jsx(U,{})]})};export{ie as default};
