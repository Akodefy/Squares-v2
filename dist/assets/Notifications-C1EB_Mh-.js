import{j as e}from"./ui-CMGlPv8M.js";import{r as i}from"./router-02yfTqxa.js";import{a1 as te,f as p,a0 as ae,a as m,b as j,c as g,e as h,U as T,E as D,J as ne,I,a5 as ie,a6 as le,a7 as k,au as re,av as R,B as v,d as ce,V as F,W as M,Y as U,Z as B,$ as O,L as c,T as de,r as V,s as L,v as P,w as $,x as d,M as oe,a2 as xe,q as me}from"./index-DGiQKbnC.js";import{f as W,h as q}from"./apiUtils-Cw-_rb0N.js";import{C as H}from"./checkbox-Cs4lqKpa.js";import{S as J}from"./send-DxBMk8cd.js";import{S as he}from"./smartphone-Chptoq49.js";import"./vendor-Dazix4UH.js";const ye=()=>{const[l,b]=i.useState([]),[z,y]=i.useState(!0),[f,G]=i.useState(""),[o,Y]=i.useState("sent"),[a,Z]=i.useState(null),[_,w]=i.useState(!1),[K,u]=i.useState(!1),[C,S]=i.useState(!1),{toast:x}=te(),[t,r]=i.useState({title:"",message:"",type:"info",recipients:"all",sendEmail:!0,sendInApp:!0});i.useEffect(()=>{A()},[o,f]);const A=async()=>{try{y(!0);const s=await W(`/subadmin/notifications?status=${o}&search=${f}`),n=await q(s);b(n.data.notifications||[])}catch(s){console.error("Error fetching notifications:",s),x({title:"Error",description:s.message||"Error fetching notifications",variant:"destructive"}),b([])}finally{y(!1)}},Q=async()=>{if(!t.title.trim()||!t.message.trim()){x({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"});return}if(!t.sendEmail&&!t.sendInApp){x({title:"Validation Error",description:"Please select at least one delivery method (Email or In-App)",variant:"destructive"});return}try{S(!0);const s=await W("/subadmin/notifications/send",{method:"POST",body:JSON.stringify(t)}),n=await q(s),{recipientCount:X,emailsSent:ee,inAppSent:se}=n.data;x({title:"Success",description:`Notification sent to ${X} users (${ee} emails, ${se} in-app)`}),u(!1),r({title:"",message:"",type:"info",recipients:"all",sendEmail:!0,sendInApp:!0}),A()}catch(s){x({title:"Error",description:s.message||"Failed to send notification",variant:"destructive"})}finally{S(!1)}},N=s=>{switch(s){case"info":return{label:"Info",class:"bg-blue-600"};case"warning":return{label:"Warning",class:"bg-yellow-600"};case"success":return{label:"Success",class:"bg-green-600"};case"error":return{label:"Error",class:"bg-red-600"};default:return{label:s,class:"bg-gray-600"}}},E=s=>{switch(s){case"vendors":return e.jsx(me,{className:"h-4 w-4"});case"customers":return e.jsx(T,{className:"h-4 w-4"});default:return e.jsx(R,{className:"h-4 w-4"})}};return z&&l.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Notifications"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and send system notifications"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Notifications"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and send system notifications"})]}),e.jsxs(p,{onClick:()=>u(!0),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Send Notification"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(m,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Total Sent"}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.filter(s=>s.status==="sent").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Notifications sent"})]})]}),e.jsxs(m,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Total Recipients"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.reduce((s,n)=>s+n.recipientCount,0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Users notified"})]})]}),e.jsxs(m,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(g,{className:"text-sm font-medium",children:"Read Rate"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[l.length>0?Math.round(l.reduce((s,n)=>s+n.readCount,0)/l.reduce((s,n)=>s+n.recipientCount,0)*100):0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Average read rate"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(I,{placeholder:"Search notifications...",value:f,onChange:s=>G(s.target.value),className:"pl-10"})]}),e.jsxs(ie,{value:o,onValueChange:Y,children:[e.jsxs(le,{children:[e.jsx(k,{value:"sent",children:"Sent"}),e.jsx(k,{value:"draft",children:"Drafts"})]}),e.jsx(re,{value:o,className:"space-y-4 mt-6",children:l.length===0?e.jsx(m,{children:e.jsxs(h,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Notifications Found"}),e.jsx("p",{className:"text-muted-foreground text-center",children:o==="sent"?"No notifications have been sent yet":"No draft notifications available"})]})}):l.map(s=>{const n=N(s.type);return e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"text-lg",children:s.title}),e.jsx(v,{className:n.class,children:n.label})]}),e.jsx(ce,{children:e.jsx("p",{className:"line-clamp-2",children:s.message})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[E(s.recipients),"Recipients: ",s.recipients==="all"?"All Users":s.recipients.charAt(0).toUpperCase()+s.recipients.slice(1)]}),e.jsxs("span",{children:["‚Ä¢ ",s.recipientCount," users"]}),s.status==="sent"&&e.jsxs("span",{children:["‚Ä¢ ",s.readCount," read (",Math.round(s.readCount/s.recipientCount*100),"%)"]})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["By: ",s.sentBy.name]})]})]})}),e.jsx(h,{children:e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{Z(s),w(!0)},children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"View Details"]})})]},s._id)})})]}),e.jsx(F,{open:_,onOpenChange:w,children:e.jsxs(M,{className:"max-w-2xl",children:[e.jsxs(U,{children:[e.jsx(B,{children:"Notification Details"}),e.jsx(O,{children:"Detailed information about the notification"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Title"}),e.jsx("p",{children:a.title})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Message"}),e.jsx("div",{className:"bg-muted p-4 rounded-lg",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:a.message})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Type"}),e.jsx(v,{className:N(a.type).class,children:N(a.type).label})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Status"}),e.jsx(v,{children:a.status})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Recipients"}),e.jsxs("p",{className:"text-sm flex items-center gap-2",children:[E(a.recipients),a.recipients==="all"?"All Users":a.recipients.charAt(0).toUpperCase()+a.recipients.slice(1)]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Recipient Count"}),e.jsxs("p",{className:"text-sm",children:[a.recipientCount," users"]})]})]}),a.status==="sent"&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Engagement"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a.readCount}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Read"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-950 p-4 rounded-lg text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-600",children:[Math.round(a.readCount/a.recipientCount*100),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Read Rate"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Sent By"}),e.jsx("p",{className:"text-sm",children:a.sentBy.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(a.createdAt).toLocaleString()})]})]})]})}),e.jsx(F,{open:K,onOpenChange:u,children:e.jsxs(M,{className:"max-w-2xl",children:[e.jsxs(U,{children:[e.jsx(B,{children:"Send New Notification"}),e.jsx(O,{children:"Create and send a notification to users via email and/or in-app"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"title",children:"Title *"}),e.jsx(I,{id:"title",placeholder:"e.g., System Maintenance, New Feature, Important Update",value:t.title,onChange:s=>r({...t,title:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"message",children:"Message *"}),e.jsx(de,{id:"message",placeholder:"Enter your notification message...",value:t.message,onChange:s=>r({...t,message:s.target.value}),rows:5}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Use clear and concise language. This message will be sent to all selected recipients."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"type",children:"Notification Type"}),e.jsxs(V,{value:t.type,onValueChange:s=>r({...t,type:s}),children:[e.jsx(L,{children:e.jsx(P,{})}),e.jsxs($,{children:[e.jsx(d,{value:"info",children:"‚ÑπÔ∏è Info"}),e.jsx(d,{value:"success",children:"‚úÖ Success"}),e.jsx(d,{value:"warning",children:"‚ö†Ô∏è Warning"}),e.jsx(d,{value:"error",children:"üî¥ Error/Alert"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"recipients",children:"Recipients"}),e.jsxs(V,{value:t.recipients,onValueChange:s=>r({...t,recipients:s}),children:[e.jsx(L,{children:e.jsx(P,{})}),e.jsxs($,{children:[e.jsx(d,{value:"all",children:"All Users"}),e.jsx(d,{value:"vendors",children:"Vendors Only"}),e.jsx(d,{value:"customers",children:"Customers Only"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsx(c,{className:"text-base",children:"Delivery Methods *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(H,{id:"sendInApp",checked:t.sendInApp,onCheckedChange:s=>r({...t,sendInApp:s})}),e.jsxs(c,{htmlFor:"sendInApp",className:"flex items-center gap-2 font-normal cursor-pointer",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:"In-App Notification"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground ml-7",children:"Real-time notification shown to users while they're active on the platform"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(H,{id:"sendEmail",checked:t.sendEmail,onCheckedChange:s=>r({...t,sendEmail:s})}),e.jsxs(c,{htmlFor:"sendEmail",className:"flex items-center gap-2 font-normal cursor-pointer",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:"Email Notification"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground ml-7",children:"Send formatted email to users' registered email addresses"})]}),!t.sendEmail&&!t.sendInApp&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-3 mt-2",children:e.jsx("p",{className:"text-xs text-destructive",children:"‚ö†Ô∏è Please select at least one delivery method"})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"üìã Common Use Cases:"}),e.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ System Maintenance: Scheduled downtime notifications"}),e.jsx("li",{children:"‚Ä¢ Platform Updates: New features or policy changes"}),e.jsx("li",{children:"‚Ä¢ Security Alerts: Important security updates"}),e.jsx("li",{children:"‚Ä¢ Service Announcements: General platform announcements"})]})]})]}),e.jsxs(xe,{children:[e.jsx(p,{variant:"outline",onClick:()=>{u(!1),r({title:"",message:"",type:"info",recipients:"all",sendEmail:!0,sendInApp:!0})},children:"Cancel"}),e.jsx(p,{onClick:Q,disabled:C||!t.sendEmail&&!t.sendInApp,children:C?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"‚è≥"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Send Notification"]})})]})]})})]})};export{ye as default};
