import{j as e}from"./ui-CMGlPv8M.js";import{r as c}from"./router-02yfTqxa.js";import{V as W,W as $,Y as L,Z as M,$ as q,L as x,I as N,f as i,E as y,S as Y,a2 as Z,R as b,t as w}from"./index-DGiQKbnC.js";import{A as K,a as B}from"./alert-CWbFXNNh.js";import{I as G,a as H,b as h}from"./input-otp-DDLYfRz_.js";import{K as k}from"./key-DPKaG5r9.js";import{T as J}from"./triangle-alert-BRpipt4V.js";import{E as v}from"./eye-off-CFJDzV2J.js";const ne=({open:D,onOpenChange:f,onSuccess:V})=>{const[a,d]=c.useState({currentPassword:"",newPassword:"",confirmPassword:"",otp:""}),[n,p]=c.useState("currentPassword"),[t,m]=c.useState(!1),[C,o]=c.useState([]),[Q,g]=c.useState(!1),[A,S]=c.useState(5),[u,P]=c.useState({current:!1,new:!1,confirm:!1}),O=s=>{const r=[];return s.length<8&&r.push("At least 8 characters"),/[A-Z]/.test(s)||r.push("One uppercase letter"),/[a-z]/.test(s)||r.push("One lowercase letter"),/\d/.test(s)||r.push("One number"),/[!@#$%^&*(),.?":{}|<>]/.test(s)||r.push("One special character"),r},z=s=>{let r=0;return s.length>=8&&r++,/[A-Z]/.test(s)&&r++,/[a-z]/.test(s)&&r++,/\d/.test(s)&&r++,/[!@#$%^&*(),.?":{}|<>]/.test(s)&&r++,r===5?{score:r,label:"Very Strong",color:"text-green-600"}:r>=4?{score:r,label:"Strong",color:"text-green-500"}:r>=3?{score:r,label:"Medium",color:"text-yellow-500"}:r>=2?{score:r,label:"Weak",color:"text-orange-500"}:{score:r,label:"Very Weak",color:"text-red-500"}},T=()=>a.currentPassword.length>0,F=()=>a.newPassword.length>=8&&a.newPassword===a.confirmPassword&&O(a.newPassword).length===0&&a.currentPassword!==a.newPassword,j=async()=>{if(n==="currentPassword"){if(!T())return;try{m(!0),o([]);const s=await b.requestPasswordChangeOTP(a.currentPassword);s.success&&(p("otp"),g(!0),S(s.expiryMinutes||5),w({title:"OTP Sent",description:"Verification code sent to your email"}))}catch(s){console.error("Failed to send OTP:",s),o([s.message||"Failed to send OTP"])}finally{m(!1)}}else if(n==="otp"){if(!a.otp.trim()){o(["Please enter the OTP"]);return}p("newPassword"),o([]),w({title:"OTP Verified",description:"Now set your new password"})}else if(n==="newPassword"){if(!F())return;try{m(!0),o([]);const s=await b.changePasswordWithOTP(a.otp,a.newPassword);if(s.success)w({title:"âœ… Password Changed Successfully",description:"Your password has been updated securely."}),d({currentPassword:"",newPassword:"",confirmPassword:"",otp:""}),p("currentPassword"),g(!1),f(!1),V?.(),w({title:"ðŸ“§ Confirmation Sent",description:"Password change confirmation sent to your email."});else throw new Error(s.message||"Failed to change password")}catch(s){const r=s.message||"Failed to change password";r.includes("Current password is incorrect")?o(["Your current password is incorrect. Please try again."]):r.includes("same as current")?o(["New password must be different from your current password."]):r.includes("OTP")?o([r]):o([r]),w({title:"âŒ Password Change Failed",description:r,variant:"destructive"})}finally{m(!1)}}},I=()=>{d({currentPassword:"",newPassword:"",confirmPassword:"",otp:""}),o([]),p("currentPassword"),g(!1),f(!1)},R=async()=>{try{m(!0),o([]);const s=await b.requestPasswordChangeOTP(a.currentPassword);s.success&&(S(s.expiryMinutes||5),w({title:"OTP Resent",description:"A new OTP has been sent to your email"}))}catch(s){o([s.message||"Failed to resend OTP"])}finally{m(!1)}},l=z(a.newPassword),E=O(a.newPassword);return e.jsx(W,{open:D,onOpenChange:f,children:e.jsxs($,{className:"sm:max-w-md",children:[e.jsxs(L,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),n==="currentPassword"?"Change Password":n==="otp"?"Verify Email":"Set New Password"]}),e.jsx(q,{children:n==="currentPassword"?"Enter your current password to proceed.":n==="otp"?"We've sent a verification code to your registered email. Please enter the code below.":"Choose a new secure password for your account."})]}),e.jsxs("div",{className:"space-y-4",children:[C.length>0&&e.jsxs(K,{variant:"destructive",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx(B,{children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:C.map((s,r)=>e.jsx("li",{children:s},r))})})]}),n==="currentPassword"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"currentPassword",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{id:"currentPassword",type:u.current?"text":"password",value:a.currentPassword,onChange:s=>d(r=>({...r,currentPassword:s.target.value})),placeholder:"Enter your current password",className:"pr-10",disabled:t,autoFocus:!0}),e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>P(s=>({...s,current:!s.current})),disabled:t,children:u.current?e.jsx(v,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]})]})}),n==="otp"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"otp",children:"Verification Code"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(G,{value:a.otp,onChange:s=>d(r=>({...r,otp:s})),maxLength:6,className:"gap-2",children:e.jsxs(H,{children:[e.jsx(h,{index:0,className:"w-12 h-12 text-lg"}),e.jsx(h,{index:1,className:"w-12 h-12 text-lg"}),e.jsx(h,{index:2,className:"w-12 h-12 text-lg"}),e.jsx(h,{index:3,className:"w-12 h-12 text-lg"}),e.jsx(h,{index:4,className:"w-12 h-12 text-lg"}),e.jsx(h,{index:5,className:"w-12 h-12 text-lg"})]})})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Code expires in ",A," minutes"]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:R,disabled:t,children:"Resend Code"})]})]}),e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-xs text-yellow-700",children:[e.jsx("p",{className:"font-medium",children:"Security Notice:"}),e.jsx("p",{children:"We've sent a verification code to your registered email address for additional security. Please check your email and enter the code above."})]})]})})]}),n==="newPassword"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"newPassword",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{id:"newPassword",type:u.new?"text":"password",value:a.newPassword,onChange:s=>d(r=>({...r,newPassword:s.target.value})),placeholder:"Enter your new password",className:"pr-10",disabled:t,autoFocus:!0}),e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>P(s=>({...s,new:!s.new})),disabled:t,children:u.new?e.jsx(v,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]})]}),a.newPassword&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Password Strength:"}),e.jsx("span",{className:`font-medium ${l.color}`,children:l.label})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${l.score===5?"bg-green-600":l.score>=4?"bg-green-500":l.score>=3?"bg-yellow-500":l.score>=2?"bg-orange-500":"bg-red-500"}`,style:{width:`${l.score/5*100}%`}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(N,{id:"confirmPassword",type:u.confirm?"text":"password",value:a.confirmPassword,onChange:s=>d(r=>({...r,confirmPassword:s.target.value})),placeholder:"Confirm your new password",className:"pr-10",disabled:t}),e.jsx(i,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>P(s=>({...s,confirm:!s.confirm})),disabled:t,children:u.confirm?e.jsx(v,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]})]}),a.newPassword&&E.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"text-sm font-medium text-red-600",children:"Password Requirements:"}),e.jsx("ul",{className:"text-sm text-red-600 space-y-1",children:E.map((s,r)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-red-600 rounded-full"}),s]},r))})]}),a.confirmPassword&&a.newPassword!==a.confirmPassword&&e.jsxs("div",{className:"text-sm text-red-600 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-red-600 rounded-full"}),"Passwords do not match"]})]})]}),e.jsxs(Z,{className:"gap-2",children:[e.jsx(i,{variant:"outline",onClick:I,disabled:t,children:"Cancel"}),n==="currentPassword"&&e.jsx(i,{onClick:j,disabled:!T()||t,className:"min-w-[120px]",children:t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Sending OTP..."]}):"Send Verification Code"}),n==="otp"&&e.jsx(i,{onClick:j,disabled:!a.otp||a.otp.length!==6||t,className:"min-w-[120px]",children:t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Verifying..."]}):"Verify Code"}),n==="newPassword"&&e.jsx(i,{onClick:j,disabled:!F()||t,className:"min-w-[120px]",children:t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Changing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Change Password"]})})]})]})})};export{ne as P};
