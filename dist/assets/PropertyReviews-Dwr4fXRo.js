import{j as e}from"./ui-CMGlPv8M.js";import{r as i}from"./router-02yfTqxa.js";import{a1 as G,aK as E,J,I as M,a as R,e as D,C as A,b as Y,aL as j,c as Z,d as K,h as X,y as q,B as Q,f as d,E as ee,H as se,V as T,W as _,Y as $,Z as k,$ as O,T as te,a2 as re}from"./index-DGiQKbnC.js";import{f as b,h as w}from"./apiUtils-Cw-_rb0N.js";import{C as ae}from"./calendar-CnnZ5ZoT.js";import"./vendor-Dazix4UH.js";const ie="https://api.akodefy.com/api",L=n=>{if(!n)return j;const a=typeof n=="object"?n.url:n;if(!a||typeof a!="string")return j;if(a.startsWith("http://")||a.startsWith("https://"))return a;const g=a.startsWith("/api")?a.substring(4):a;return`${ie.replace("/api","")}${g}`},xe=()=>{const[n,a]=i.useState([]),[g,u]=i.useState(!0),[f,U]=i.useState(""),[l,P]=i.useState(1),[v,B]=i.useState(1),[t,N]=i.useState(null),[I,x]=i.useState(!1),[F,C]=i.useState(!1),[m,y]=i.useState(""),[c,p]=i.useState({}),{toast:o}=G();i.useEffect(()=>{h()},[l,f]);const h=async()=>{try{u(!0);const s=await b(`/subadmin/properties/pending?page=${l}&search=${f}`),r=await w(s);a(r.data.properties||[]),B(r.data.totalPages||1)}catch(s){console.error("Error fetching properties:",s),o({title:"Error",description:s.message||"Error fetching properties",variant:"destructive"}),a([])}finally{u(!1)}};E("property_created",s=>{o({title:"New Property",description:"A new property has been submitted for review"}),h()}),E("property_updated",s=>{h()});const W=async s=>{try{p({...c,[s]:!0});const r=await b(`/subadmin/properties/${s}/approve`,{method:"POST"});await w(r),o({title:"Success",description:"Property approved successfully"}),h()}catch(r){console.error("Error approving property:",r),o({title:"Error",description:r.message||"Failed to approve property",variant:"destructive"})}finally{p({...c,[s]:!1})}},z=async()=>{if(!t||!m.trim()){o({title:"Error",description:"Please provide a rejection reason",variant:"destructive"});return}try{p({...c,[t._id]:!0});const s=await b(`/subadmin/properties/${t._id}/reject`,{method:"POST",body:JSON.stringify({reason:m})});await w(s),o({title:"Success",description:"Property rejected successfully"}),x(!1),y(""),N(null),h()}catch{o({title:"Error",description:"Failed to reject property",variant:"destructive"})}finally{p({...c,[t._id]:!1})}},S=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(s),H=s=>s.builtUp?`${s.builtUp} ${s.unit}`:s.plot?`${s.plot} ${s.unit}`:s.carpet?`${s.carpet} ${s.unit}`:"N/A";return g&&n.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Reviews"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and approve property listings"})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Property Reviews"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and approve property listings"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Search properties by title or city...",value:f,onChange:s=>U(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsx(R,{children:e.jsxs(D,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(A,{className:"h-12 w-12 text-green-500 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Pending Properties"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"All properties have been reviewed. Great job!"})]})}):n.map(s=>e.jsxs(R,{children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.images&&s.images.length>0&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:L(s.images[0]),alt:s.title,className:"w-24 h-24 object-cover rounded",onError:r=>{r.target.src=j}})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Z,{className:"text-xl",children:s.title}),e.jsx(K,{className:"space-y-1",children:e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"}),s.address.city,", ",s.address.state]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3"}),new Date(s.createdAt).toLocaleDateString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),s.owner.email]})]})})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:S(s.price)}),e.jsxs(Q,{variant:"outline",children:[s.type," â€¢ ",s.listingType]})]})]})}),e.jsx(D,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>{N(s),C(!0)},children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"View Details"]}),e.jsxs(d,{size:"sm",onClick:()=>W(s._id),disabled:c[s._id],className:"bg-green-600 hover:bg-green-700",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Approve"]}),e.jsxs(d,{variant:"destructive",size:"sm",onClick:()=>{N(s),x(!0)},disabled:c[s._id],children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Reject"]})]})})]},s._id))}),v>1&&e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(d,{variant:"outline",disabled:l===1,onClick:()=>P(l-1),children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm",children:["Page ",l," of ",v]}),e.jsx(d,{variant:"outline",disabled:l===v,onClick:()=>P(l+1),children:"Next"})]}),e.jsx(T,{open:I,onOpenChange:x,children:e.jsxs(_,{children:[e.jsxs($,{children:[e.jsx(k,{children:"Reject Property"}),e.jsx(O,{children:"Please provide a reason for rejecting this property listing."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:t?.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t?.address.city,", ",t?.address.state]})]}),e.jsx(te,{placeholder:"Enter rejection reason...",value:m,onChange:s=>y(s.target.value),rows:4})]}),e.jsxs(re,{children:[e.jsx(d,{variant:"outline",onClick:()=>{x(!1),y("")},children:"Cancel"}),e.jsx(d,{variant:"destructive",onClick:z,disabled:!m.trim()||c[t?._id||""],children:"Reject Property"})]})]})}),e.jsx(T,{open:F,onOpenChange:C,children:e.jsxs(_,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(k,{children:t?.title}),e.jsx(O,{children:"Property details and information"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Property Details"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Type:"})," ",t.type]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Listing Type:"})," ",t.listingType]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Price:"})," ",S(t.price)]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Area:"})," ",H(t.area)]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bedrooms:"})," ",t.bedrooms]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bathrooms:"})," ",t.bathrooms]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Location & Contact"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Address:"})," ",t.address.street]}),e.jsxs("li",{children:[e.jsx("strong",{children:"City:"})," ",t.address.city]}),e.jsxs("li",{children:[e.jsx("strong",{children:"State:"})," ",t.address.state]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Zip Code:"})," ",t.address.zipCode]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Owner:"})," ",t.owner.name]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Email:"})," ",t.owner.email]})]})]})]}),t.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Description"}),e.jsx("p",{className:"text-sm",children:t.description})]}),t.images&&t.images.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Images"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:t.images.map((s,r)=>e.jsx("img",{src:L(s),alt:`Property ${r+1}`,className:"w-full h-32 object-cover rounded",onError:V=>{V.target.src=j}},r))})]})]})]})})]})};export{xe as default};
