import{j as e}from"./ui-DOY6021Z.js";import{r,R as M}from"./router-2SVJvIbS.js";import{D as _,a as q,b as H,c as V,d as z,e as G}from"./dialog-Dy1IM_sd.js";import{G as W,B as u,C as Y,f as p,H as J,I as K,q as Q,r as X,s as Z,v as O,w as ee}from"./index-8dkl62y8.js";import{L as o}from"./label-UWGJ9NFN.js";import{T as se}from"./textarea-DlstSMUc.js";import{A as T,a as D}from"./alert-DsPhAFEb.js";import{u as te}from"./userService-6V1iEl1Q.js";import{C as ae}from"./circle-alert-DW1bA-Sc.js";const xe=({property:t,open:i,onOpenChange:m,onUpdateStatus:A})=>{const{toast:h}=W(),[l,f]=r.useState(""),[j,v]=r.useState(""),[S,N]=r.useState(!1),[n,b]=r.useState(""),[P,$]=r.useState([]),[F,C]=r.useState(!1),[x,y]=r.useState(""),c=t?.status==="active",a=(()=>{if(!t)return null;const s=t.listingType||"sale";return s==="sale"?{value:"sold",label:"Mark as Sold",color:"bg-blue-500"}:s==="rent"?{value:"rented",label:"Mark as Rented",color:"bg-purple-500"}:s==="lease"?{value:"leased",label:"Mark as Leased",color:"bg-indigo-500"}:null})();r.useEffect(()=>{i&&c&&a&&k()},[i]);const k=async()=>{try{C(!0),console.log("[PropertyStatusDialog] Loading customers with role: customer");const s=await te.getUsers({role:"customer",limit:100,status:"active"});console.log("[PropertyStatusDialog] Customer response:",s),s.success&&s.data?.users?(console.log(`[PropertyStatusDialog] Loaded ${s.data.users.length} customers`),$(s.data.users)):(console.error("[PropertyStatusDialog] Invalid response structure:",s),h({title:"Warning",description:"Failed to load customers properly.",variant:"default"}))}catch(s){console.error("[PropertyStatusDialog] Failed to load customers:",s),h({title:"Error",description:"Failed to load customers.",variant:"destructive"})}finally{C(!1)}},w=P.filter(s=>{const g=x.toLowerCase(),U=`${s.profile?.firstName||""} ${s.profile?.lastName||""}`.toLowerCase(),E=s.email?.toLowerCase()||"",I=s.profile?.phone||"";return U.includes(g)||E.includes(g)||I.includes(g)});M.useEffect(()=>{t&&i&&(f(""),v(""),b(""),y(""))},[t,i]);const R=()=>{a&&f(a.value)},B=async()=>{if(!(!t||!l)){if(!n){h({title:"Customer Required",description:`Please select a customer to assign this ${l} property to.`,variant:"destructive"});return}N(!0);try{await A(t._id,l,n,j.trim()||void 0),m(!1)}catch(s){console.error("Failed to update status:",s)}finally{N(!1)}}},L=s=>{switch(s){case"active":return"bg-green-500";case"pending":return"bg-yellow-500";case"sold":return"bg-blue-500";case"rented":return"bg-purple-500";case"leased":return"bg-indigo-500";case"rejected":return"bg-red-500";default:return"bg-gray-500"}},d=s=>{switch(s){case"active":return"Active";case"pending":return"Pending Approval";case"sold":return"Sold";case"rented":return"Rented";case"leased":return"Leased";case"rejected":return"Rejected";default:return s.charAt(0).toUpperCase()+s.slice(1)}};return e.jsx(_,{open:i,onOpenChange:m,children:e.jsxs(q,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(H,{children:[e.jsx(V,{children:"Update Property Status"}),e.jsx(z,{children:t?.title}),t?.listingType&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Listing Type: ",e.jsx(u,{variant:"outline",className:"ml-1",children:t.listingType})]})]}),"        ",e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Current Status"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(u,{className:`${L(t?.status||"")} text-white`,children:d(t?.status||"")})})]}),!c&&e.jsxs(T,{children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsxs(D,{children:["This property is not yet approved by admin. You can only update the status to ",a?.label.toLowerCase()," after admin approval."]})]}),t?.status==="sold"||t?.status==="rented"||t?.status==="leased"?e.jsxs(T,{children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsxs(D,{children:["This property has already been marked as ",d(t.status).toLowerCase(),"."]})]}):l===""?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Action"}),e.jsx(p,{onClick:R,disabled:!c||!a,className:`w-full ${a?.color||"bg-primary"} hover:opacity-90 text-white`,size:"lg",children:a?.label||"Update Status"}),!c&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Button will be enabled once admin approves your property"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"customer-search",children:"Search Customer"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(K,{id:"customer-search",placeholder:"Search by name, email, or phone...",value:x,onChange:s=>y(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"customer-select",children:"Assign To Customer *"}),F?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading customers..."}):e.jsxs(Q,{value:n,onValueChange:b,children:[e.jsx(X,{children:e.jsx(Z,{placeholder:"Select customer who bought/rented this property"})}),e.jsx(O,{children:w.length===0?e.jsx("div",{className:"p-2 text-sm text-muted-foreground text-center",children:x?"No customers found":"No customers available"}):w.map(s=>e.jsx(ee,{value:s._id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[s.profile?.firstName," ",s.profile?.lastName]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.email," ",s.profile?.phone&&`• ${s.profile.phone}`]})]})},s._id))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This property will be added to the selected customer's portfolio"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"reason",children:"Additional Notes (Optional)"}),e.jsx(se,{id:"reason",placeholder:"Add any notes about this transaction...",value:j,onChange:s=>v(s.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Status Change Preview"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:`${L(t?.status||"")} text-white`,children:d(t?.status||"")}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx(u,{className:`${a?.color||"bg-gray-500"} text-white`,children:d(l)})]})]})]})]}),e.jsxs(G,{children:[e.jsx(p,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),l&&e.jsx(p,{onClick:B,disabled:S||!n,className:`${a?.color||"bg-primary"} hover:opacity-90 text-white`,children:S?"Updating...":`Confirm ${a?.label}`})]})]})})};export{xe as P};
