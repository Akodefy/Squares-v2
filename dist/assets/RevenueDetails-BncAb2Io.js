import{j as e}from"./ui-CMGlPv8M.js";import{d as A,r as d}from"./router-02yfTqxa.js";import{A as E,t as M,f,D as P,a as r,b as n,c as i,e as c,n as L,H as v,C as T}from"./index-DGiQKbnC.js";import{D as B}from"./download-Dx_JF_-F.js";import"./vendor-Dazix4UH.js";const O=()=>{const g=A(),[m,N]=d.useState([]),[b,y]=d.useState(!0),[l,w]=d.useState({totalRevenue:0,thisMonthRevenue:0,activeSubscriptions:0,expiredSubscriptions:0,averageRevenue:0});d.useEffect(()=>{D()},[]);const D=async()=>{try{const t=E.getToken(),u=await fetch("https://api.akodefy.com/api/subscriptions/all",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!u.ok)throw new Error("Failed to fetch revenue data");const h=await u.json();if(h.success){const a=h.data.subscriptions;N(a);const p=new Date,C=new Date(p.getFullYear(),p.getMonth(),1),j=a.filter(s=>["active","expired"].includes(s.status)&&s.lastPaymentDate).reduce((s,x)=>s+x.amount,0),k=a.filter(s=>["active","expired"].includes(s.status)&&s.lastPaymentDate&&new Date(s.lastPaymentDate)>=C).reduce((s,x)=>s+x.amount,0);w({totalRevenue:j,thisMonthRevenue:k,activeSubscriptions:a.filter(s=>s.status==="active").length,expiredSubscriptions:a.filter(s=>s.status==="expired").length,averageRevenue:a.length>0?j/a.length:0})}}catch(t){console.error("Error fetching revenue data:",t),M({title:"Error",description:"Failed to load revenue data",variant:"destructive"})}finally{y(!1)}},o=t=>`â‚¹${t.toLocaleString("en-IN")}`,R=t=>new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),S=t=>{switch(t){case"active":return e.jsx(T,{className:"w-4 h-4 text-green-600"});case"expired":return e.jsx(v,{className:"w-4 h-4 text-red-600"});case"cancelled":return e.jsx(v,{className:"w-4 h-4 text-gray-600"});default:return e.jsx(L,{className:"w-4 h-4 text-yellow-600"})}};return b?e.jsx("div",{className:"flex justify-center items-center py-12",children:"Loading..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(f,{variant:"ghost",onClick:()=>g("/admin/dashboard"),children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Revenue Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete revenue breakdown and subscription history"})]}),e.jsxs(f,{variant:"outline",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Export Report"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs(r,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"Total Revenue"})}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:o(l.totalRevenue)})})]}),e.jsxs(r,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"This Month"})}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o(l.thisMonthRevenue)})})]}),e.jsxs(r,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"Active Subscriptions"})}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.activeSubscriptions})})]}),e.jsxs(r,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"Expired"})}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:l.expiredSubscriptions})})]}),e.jsxs(r,{children:[e.jsx(n,{className:"pb-2",children:e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"Average Revenue"})}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:o(Math.round(l.averageRevenue))})})]})]}),e.jsxs(r,{children:[e.jsx(n,{children:e.jsx(i,{children:"All Subscriptions"})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-3",children:m.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No subscriptions found"}):m.map(t=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-accent/50 transition",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 items-center",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsxs("p",{className:"font-medium",children:[t.user?.profile?.firstName," ",t.user?.profile?.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.user?.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Plan"}),e.jsx("p",{className:"font-medium",children:t.plan?.name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"font-bold text-emerald-600",children:o(t.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Payment Date"}),e.jsx("p",{className:"text-sm",children:t.lastPaymentDate?R(t.lastPaymentDate):"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S(t.status),e.jsx("span",{className:"text-sm capitalize",children:t.status})]})]})},t._id))})})]})]})};export{O as default};
