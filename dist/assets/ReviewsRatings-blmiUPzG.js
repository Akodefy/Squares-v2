import{j as e}from"./ui-DOY6021Z.js";import{r as l}from"./router-2SVJvIbS.js";import{t as m,av as Se,ai as R,f as g,B as E,q as M,r as A,s as O,v as q,w as v,I as Z,a as T,b as ee,c as se,e as k,H as Pe,O as te,Q as Ce,R as re,h as ae,x as Te}from"./index-8dkl62y8.js";import{T as ke}from"./textarea-DlstSMUc.js";import{D as $e,f as Ie,a as Ee,b as Fe,c as De}from"./dialog-Dy1IM_sd.js";import{L as F}from"./label-UWGJ9NFN.js";import{P as V}from"./pen-line-CsoOJxzw.js";import{L as H}from"./loader-circle-BnrCgTju.js";import{C as Le}from"./calendar-DLw8psl4.js";import{F as Me,T as Ae,a as Oe,R as qe}from"./thumbs-up-DkrLMAJg.js";import{T as Ve}from"./trash-2-C5jIrlx2.js";import"./vendor-Dazix4UH.js";const _e="https://squares-v2.onrender.com/api";class He{async makeRequest(r,a={}){const i=`${_e}${r}`,n={headers:{"Content-Type":"application/json",...a.headers},...a},p=localStorage.getItem("token");p&&(n.headers={...n.headers,Authorization:`Bearer ${p}`});try{const c=await fetch(i,n);if(!c.ok){const d=await c.json().catch(()=>({success:!1,message:`HTTP ${c.status}: ${c.statusText}`}));throw new Error(d.message||"An error occurred")}return await c.json()}catch(c){throw console.error("Customer Reviews API request failed:",c),c}}async getMyReviews(r={}){try{const a=new URLSearchParams;Object.entries(r).forEach(([p,c])=>{c!=null&&c!==""&&a.append(p,c.toString())});const i=`/customer/reviews/my-reviews${a.toString()?`?${a.toString()}`:""}`,n=await this.makeRequest(i);return n.success&&n.data?n.data:{reviews:[],totalCount:0,totalPages:0,currentPage:1}}catch(a){return console.error("Failed to fetch my reviews:",a),{reviews:[],totalCount:0,totalPages:0,currentPage:1}}}async getReceivedReviews(r={}){try{const a=new URLSearchParams;Object.entries(r).forEach(([p,c])=>{c!=null&&c!==""&&a.append(p,c.toString())});const i=`/customer/reviews/received${a.toString()?`?${a.toString()}`:""}`,n=await this.makeRequest(i);return n.success&&n.data?n.data:{reviews:[],totalCount:0,totalPages:0,currentPage:1}}catch(a){return console.error("Failed to fetch received reviews:",a),{reviews:[],totalCount:0,totalPages:0,currentPage:1}}}async getMyReviewStats(){try{const r=await this.makeRequest("/customer/reviews/my-stats");return r.success&&r.data?r.data:{totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0},recentReviews:0,responseRate:0,averageResponseTime:0,verifiedReviews:0,publicReviews:0,helpfulVotes:0}}catch(r){return console.error("Failed to fetch my review stats:",r),{totalReviews:0,averageRating:0,ratingDistribution:{5:0,4:0,3:0,2:0,1:0},recentReviews:0,responseRate:0,averageResponseTime:0,verifiedReviews:0,publicReviews:0,helpfulVotes:0}}}async createReview(r){try{const a=await this.makeRequest("/customer/reviews",{method:"POST",body:JSON.stringify(r)});if(a.success)return m({title:"Success",description:a.message||"Review submitted successfully!"}),a.data;throw new Error(a.message||"Failed to submit review")}catch(a){const i=a instanceof Error?a.message:"Failed to submit review";return m({title:"Error",description:i,variant:"destructive"}),null}}async updateReview(r,a){try{const i=await this.makeRequest(`/customer/reviews/${r}`,{method:"PUT",body:JSON.stringify(a)});if(i.success)return m({title:"Success",description:i.message||"Review updated successfully!"}),i.data;throw new Error(i.message||"Failed to update review")}catch(i){const n=i instanceof Error?i.message:"Failed to update review";return m({title:"Error",description:n,variant:"destructive"}),null}}async deleteReview(r){try{const a=await this.makeRequest(`/customer/reviews/${r}`,{method:"DELETE"});if(a.success)return m({title:"Success",description:a.message||"Review deleted successfully!"}),!0;throw new Error(a.message||"Failed to delete review")}catch(a){const i=a instanceof Error?a.message:"Failed to delete review";return m({title:"Error",description:i,variant:"destructive"}),!1}}async markReviewHelpful(r,a){try{const i=await this.makeRequest(`/customer/reviews/${r}/helpful`,{method:"POST",body:JSON.stringify({isHelpful:a})});if(i.success)return!0;throw new Error(i.message||"Failed to mark review as helpful")}catch(i){return console.error("Failed to mark review as helpful:",i),!1}}async replyToReview(r,a){try{const i=await this.makeRequest(`/customer/reviews/${r}/reply`,{method:"POST",body:JSON.stringify({message:a})});if(i.success)return m({title:"Success",description:i.message||"Reply posted successfully!"}),!0;throw new Error(i.message||"Failed to post reply")}catch(i){const n=i instanceof Error?i.message:"Failed to post reply";return m({title:"Error",description:n,variant:"destructive"}),!1}}async reportReview(r,a){try{const i=await this.makeRequest(`/customer/reviews/${r}/report`,{method:"POST",body:JSON.stringify({reason:a})});if(i.success)return m({title:"Success",description:i.message||"Review reported successfully!"}),!0;throw new Error(i.message||"Failed to report review")}catch(i){const n=i instanceof Error?i.message:"Failed to report review";return m({title:"Error",description:n,variant:"destructive"}),!1}}async getReviewableItems(){try{const r=await this.makeRequest("/customer/reviews/reviewable-items");return r.success&&r.data?r.data:{properties:[],services:[],vendors:[]}}catch(r){return console.error("Failed to fetch reviewable items:",r),{properties:[],services:[],vendors:[]}}}formatRating(r){return r.toFixed(1)}formatDate(r){return new Date(r).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}getRelativeTime(r){const a=new Date(r),n=Math.floor((new Date().getTime()-a.getTime())/1e3);return n<60?"Just now":n<3600?`${Math.floor(n/60)} minutes ago`:n<86400?`${Math.floor(n/3600)} hours ago`:n<2592e3?`${Math.floor(n/86400)} days ago`:n<31536e3?`${Math.floor(n/2592e3)} months ago`:`${Math.floor(n/31536e3)} years ago`}getRatingColor(r){return r>=4.5?"text-green-600":r>=3.5?"text-yellow-600":r>=2.5?"text-orange-600":"text-red-600"}getReviewTypeLabel(r){return{property:"Property Review",service:"Service Review",vendor:"Vendor Review"}[r]||r}getReviewTypeColor(r){return{property:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",service:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",vendor:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"}[r]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}getRatingPercentage(r,a){return a===0?0:Math.round(r/a*100)}}const x=new He,ts=()=>{const{subscribe:D}=Se(),[r,a]=l.useState("received"),[i,n]=l.useState(""),[p,c]=l.useState("all"),[d,ie]=l.useState("newest"),[ne,$]=l.useState(!1),[ze,oe]=l.useState(null),[ce,le]=l.useState([]),[de,ue]=l.useState([]),[N,me]=l.useState(null),[P,ve]=l.useState({properties:[],services:[],vendors:[]}),[he,z]=l.useState(!0),[pe,B]=l.useState(!0),[xe,U]=l.useState(!0),[W,G]=l.useState(!1),[j,ge]=l.useState({currentPage:1,totalPages:1,totalCount:0}),[b,we]=l.useState({currentPage:1,totalPages:1,totalCount:0}),[u,S]=l.useState({rating:0,title:"",comment:"",reviewType:"property",isPublic:!0,tags:[]});l.useEffect(()=>{L(),r==="received"?(w(),I()):y()},[r]),l.useEffect(()=>{const s=D("review_updated",o=>{r==="received"?(w(j.currentPage),I()):y(b.currentPage)}),t=D("review_created",o=>{L(),r==="received"?(w(j.currentPage),I()):y(b.currentPage)});return()=>{s(),t()}},[D,r,j.currentPage,b.currentPage]);const w=async(s=1)=>{z(!0);try{const t=await x.getReceivedReviews({page:s,limit:10,search:i||void 0,rating:p!=="all"?parseInt(p):void 0,sortBy:d==="newest"||d==="oldest"?"createdAt":d==="highest"||d==="lowest"?"rating":d==="helpful"?"helpfulCount":"createdAt",sortOrder:d==="oldest"||d==="lowest"?"asc":"desc"});le(t.reviews),ge({currentPage:t.currentPage,totalPages:t.totalPages,totalCount:t.totalCount})}catch(t){console.error("Failed to load received reviews:",t),m({title:"Error",description:"Failed to load received reviews",variant:"destructive"})}finally{z(!1)}},y=async(s=1)=>{B(!0);try{const t=await x.getMyReviews({page:s,limit:10,search:i||void 0,rating:p!=="all"?parseInt(p):void 0,sortBy:d==="newest"||d==="oldest"?"createdAt":d==="highest"||d==="lowest"?"rating":d==="helpful"?"helpfulCount":"createdAt",sortOrder:d==="oldest"||d==="lowest"?"asc":"desc"});ue(t.reviews),we({currentPage:t.currentPage,totalPages:t.totalPages,totalCount:t.totalCount})}catch(t){console.error("Failed to load given reviews:",t),m({title:"Error",description:"Failed to load given reviews",variant:"destructive"})}finally{B(!1)}},I=async()=>{U(!0);try{const s=await x.getMyReviewStats();me(s)}catch(s){console.error("Failed to load review stats:",s)}finally{U(!1)}},L=async()=>{try{const s=await x.getReviewableItems();ve(s)}catch(s){console.error("Failed to load reviewable items:",s)}};l.useEffect(()=>{const s=setTimeout(()=>{r==="received"?w(1):y(1)},500);return()=>clearTimeout(s)},[i,p,d]);const _=r==="received"?ce:de,f=r==="received"?j:b,J=r==="received"?he:pe,Y=N?.averageRating||0,fe=N?[5,4,3,2,1].map(s=>({rating:s,count:N.ratingDistribution[s]||0,percentage:N.totalReviews>0?(N.ratingDistribution[s]||0)/N.totalReviews*100:0})):[],ye=async()=>{if(!u.rating||!u.title.trim()||!u.comment.trim()){m({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}G(!0);try{await x.createReview(u)&&($(!1),S({rating:0,title:"",comment:"",reviewType:"property",isPublic:!0,tags:[]}),await L(),r==="given"?await y(1):r==="received"&&(await w(1),await I()),m({title:"Success",description:"Review submitted successfully"}))}catch(s){console.error("Failed to submit review:",s)}finally{G(!1)}},je=async s=>{if(window.confirm("Are you sure you want to delete this review?"))try{await x.deleteReview(s)&&(await L(),r==="received"?(await w(j.currentPage),await I()):await y(b.currentPage),m({title:"Success",description:"Review deleted successfully"}))}catch(t){console.error("Failed to delete review:",t)}},Q=async(s,t)=>{try{await x.markReviewHelpful(s,t)&&(r==="received"?await w(j.currentPage):await y(b.currentPage))}catch(o){console.error("Failed to mark review as helpful:",o)}},Re=async(s,t)=>{try{await x.replyToReview(s,t)&&(await w(j.currentPage),m({title:"Success",description:"Reply posted successfully"}))}catch(o){console.error("Failed to reply to review:",o)}},Ne=async(s,t)=>{try{await x.reportReview(s,t)}catch(o){console.error("Failed to report review:",o)}},K=(s,t="sm")=>{const o={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(h=>e.jsx(R,{className:`${o[t]} ${h<=s?"fill-yellow-400 text-yellow-400":"text-muted-foreground"}`},h))})},be=s=>s.property?`${s.property.title} - ${s.property.location}`:s.service?`${s.service.name} (${s.service.category})`:s.vendor?s.vendor.businessName||s.vendor.name:"Unknown",X=()=>{const s=[];return P.properties.filter(t=>t.canReview&&!t.hasReviewed).forEach(t=>{const o=t.status==="purchased"?"Purchased":t.status==="rented"?"Rented":"Leased",h=t.purchaseDate?` (${o} on ${new Date(t.purchaseDate).toLocaleDateString()})`:` (${o})`;s.push({id:t._id,type:"property",name:`${t.title} - ${t.location}${h}`,category:"Property",status:t.status,canReview:!0})}),P.services.filter(t=>t.canReview&&!t.hasReviewed&&t.status==="completed").forEach(t=>{const o=t.completionDate?` (Completed on ${new Date(t.completionDate).toLocaleDateString()})`:" (Completed)";s.push({id:t._id,type:"service",name:`${t.name} by ${t.vendorName}${o}`,category:t.category,status:t.status,canReview:!0})}),P.vendors.filter(t=>t.canReview&&!t.hasReviewed).forEach(t=>{const o=t.interactionDate?` (${new Date(t.interactionDate).toLocaleDateString()})`:"";s.push({id:t._id,type:"vendor",name:`${t.businessName||t.name}${o}`,category:"Vendor",status:"active",canReview:!0})}),s},C=()=>{const s=P.properties.filter(h=>h.canReview&&!h.hasReviewed).length,t=P.services.filter(h=>h.canReview&&!h.hasReviewed&&h.status==="completed").length,o=P.vendors.filter(h=>h.canReview&&!h.hasReviewed).length;return s+t+o};return e.jsxs("div",{className:"space-y-6 pt-16",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(R,{className:"w-8 h-8 text-primary"}),"Reviews & Ratings"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your reviews and see what others are saying"})]}),e.jsxs($e,{open:ne,onOpenChange:$,children:[e.jsx(Ie,{asChild:!0,children:e.jsxs(g,{disabled:C()===0,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Write Review",C()>0&&e.jsx(E,{variant:"secondary",className:"ml-2",children:C()})]})}),e.jsxs(Ee,{className:"max-w-2xl",children:[e.jsxs(Fe,{children:[e.jsx(De,{children:"Write a Review"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Review properties you've purchased/rented or services you've received"})]}),C()===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Items to Review"}),e.jsx("p",{className:"text-muted-foreground",children:"You can only review properties you've purchased/rented or services you've completed. Complete a transaction or service booking to leave a review."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Review Type"}),e.jsxs(M,{value:u.reviewType,onValueChange:s=>S(t=>({...t,reviewType:s,propertyId:void 0,serviceId:void 0,vendorId:void 0})),children:[e.jsx(A,{children:e.jsx(O,{placeholder:"Choose what to review"})}),e.jsxs(q,{children:[e.jsx(v,{value:"property",children:"Property"}),e.jsx(v,{value:"service",children:"Service"}),e.jsx(v,{value:"vendor",children:"Vendor"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{children:["Select ",u.reviewType]}),e.jsxs(M,{value:u.reviewType==="property"?u.propertyId:u.reviewType==="service"?u.serviceId:u.vendorId,onValueChange:s=>{const t={};u.reviewType==="property"?t.propertyId=s:u.reviewType==="service"?t.serviceId=s:t.vendorId=s,S(o=>({...o,...t}))},children:[e.jsx(A,{children:e.jsx(O,{placeholder:`Choose a ${u.reviewType} to review`})}),e.jsx(q,{children:X().filter(s=>s.type===u.reviewType).map(s=>e.jsx(v,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Rating"}),e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{onClick:()=>S(t=>({...t,rating:s})),className:"focus:outline-none",children:e.jsx(R,{className:`w-8 h-8 ${s<=u.rating?"fill-yellow-400 text-yellow-400":"text-muted-foreground hover:text-yellow-400"}`})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Review Title"}),e.jsx(Z,{placeholder:"Summarize your experience",value:u.title,onChange:s=>S(t=>({...t,title:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Your Review"}),e.jsx(ke,{placeholder:"Share your detailed experience...",rows:4,value:u.comment,onChange:s=>S(t=>({...t,comment:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{variant:"outline",onClick:()=>$(!1),children:"Cancel"}),e.jsxs(g,{onClick:ye,disabled:W,children:[W&&e.jsx(H,{className:"w-4 h-4 mr-2 animate-spin"}),"Submit Review"]})]})]})]})]})]}),r==="received"&&e.jsxs(T,{children:[e.jsx(ee,{children:e.jsx(se,{children:"Rating Overview"})}),e.jsx(k,{children:xe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(H,{className:"w-6 h-6 animate-spin"})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold mb-2",children:Y.toFixed(1)}),K(Math.round(Y),"lg"),e.jsxs("p",{className:"text-muted-foreground mt-2",children:["Based on ",N?.totalReviews||0," reviews"]})]}),e.jsx("div",{className:"space-y-2",children:fe.map(({rating:s,count:t,percentage:o})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium w-8",children:s}),e.jsx(R,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}),e.jsx("div",{className:"flex-1 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${o}%`}})}),e.jsx("span",{className:"text-sm text-muted-foreground w-8",children:t})]},s))})]})})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex bg-muted rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>a("received"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${r==="received"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:["Received Reviews (",j.totalCount,")"]}),e.jsxs("button",{onClick:()=>a("given"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${r==="given"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:["Given Reviews (",b.totalCount,")"]})]})}),e.jsx(T,{children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Z,{placeholder:"Search reviews...",className:"pl-10",value:i,onChange:s=>n(s.target.value)})]}),e.jsxs(M,{value:p,onValueChange:c,children:[e.jsx(A,{className:"w-full md:w-48",children:e.jsx(O,{placeholder:"Filter by rating"})}),e.jsxs(q,{children:[e.jsx(v,{value:"all",children:"All Ratings"}),e.jsx(v,{value:"5",children:"5 Stars"}),e.jsx(v,{value:"4",children:"4 Stars"}),e.jsx(v,{value:"3",children:"3 Stars"}),e.jsx(v,{value:"2",children:"2 Stars"}),e.jsx(v,{value:"1",children:"1 Star"})]})]}),e.jsxs(M,{value:d,onValueChange:ie,children:[e.jsx(A,{className:"w-full md:w-48",children:e.jsx(O,{placeholder:"Sort by"})}),e.jsxs(q,{children:[e.jsx(v,{value:"newest",children:"Newest First"}),e.jsx(v,{value:"oldest",children:"Oldest First"}),e.jsx(v,{value:"highest",children:"Highest Rating"}),e.jsx(v,{value:"lowest",children:"Lowest Rating"}),e.jsx(v,{value:"helpful",children:"Most Helpful"})]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[J?e.jsx(T,{children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(H,{className:"w-6 h-6 animate-spin mr-2"}),"Loading reviews..."]})})}):_.length===0?e.jsx(T,{children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Reviews Found"}),e.jsx("p",{className:"text-muted-foreground",children:r==="received"?"You haven't received any reviews yet. Start listing properties or offering services to receive customer feedback.":"You haven't written any reviews yet. Purchase a property or book a service to share your experience."}),r==="given"&&C()>0&&e.jsxs(g,{className:"mt-4",onClick:()=>$(!0),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Write Your First Review"]})]})})}):_.map(s=>e.jsx(T,{children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(te,{children:[e.jsx(Ce,{src:s.clientAvatar}),e.jsx(re,{children:s.clientName.split(" ").map(t=>t[0]).join("")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-semibold",children:s.clientName}),s.isVerified&&e.jsx(E,{variant:"secondary",className:"text-xs",children:"Verified"}),e.jsx(E,{className:`text-xs ${x.getReviewTypeColor(s.reviewType)}`,children:x.getReviewTypeLabel(s.reviewType)})]}),K(s.rating),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(Le,{className:"w-3 h-3"}),x.formatDate(s.createdAt)]})]})]}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>Ne(s._id,"inappropriate"),children:e.jsx(Me,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"bg-muted/50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:be(s)})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:s.title}),e.jsx("p",{className:"text-muted-foreground",children:s.comment}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.tags.map((t,o)=>e.jsx(E,{variant:"outline",className:"text-xs",children:t},o))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{className:`flex items-center gap-1 text-sm transition-colors ${s.userHelpfulVote==="helpful"?"text-green-600":"text-muted-foreground hover:text-foreground"}`,onClick:()=>Q(s._id,!0),children:[e.jsx(Ae,{className:"w-4 h-4"}),"Helpful (",s.helpfulCount,")"]}),e.jsxs("button",{className:`flex items-center gap-1 text-sm transition-colors ${s.userHelpfulVote==="unhelpful"?"text-red-600":"text-muted-foreground hover:text-foreground"}`,onClick:()=>Q(s._id,!1),children:[e.jsx(Oe,{className:"w-4 h-4"}),"Not Helpful (",s.unhelpfulCount,")"]})]}),r==="received"&&e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>{const t=prompt("Enter your reply:");t&&Re(s._id,t)},children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Reply"]}),r==="given"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>oe(s._id),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(g,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>je(s._id),children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),s.vendorResponse&&e.jsx("div",{className:"space-y-3 pl-12 border-l-2 border-muted",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-6 h-6",children:e.jsx(re,{className:"text-xs",children:s.vendorResponse.vendorName.split(" ").map(t=>t[0]).join("")})}),e.jsx("span",{className:"font-medium text-sm",children:s.vendorResponse.vendorName}),e.jsx(E,{variant:"secondary",className:"text-xs",children:"Owner"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:x.formatDate(s.vendorResponse.respondedAt)})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-8",children:s.vendorResponse.message})]})})]})})},s._id)),r==="given"&&_.length===0&&!J&&C()>0&&e.jsxs(T,{children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-primary"}),"Items You Can Review"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"These are properties you've purchased/rented or services you've completed. Share your experience!"})]}),e.jsx(k,{children:e.jsx("div",{className:"grid gap-4",children:X().map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${s.type==="property"?"bg-blue-100 text-blue-600":s.type==="service"?"bg-green-100 text-green-600":"bg-purple-100 text-purple-600"}`,children:s.type==="property"?e.jsx(ae,{className:"w-5 h-5"}):s.type==="service"?e.jsx(R,{className:"w-5 h-5"}):e.jsx(Te,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.category})]})]}),e.jsxs(g,{size:"sm",onClick:()=>{S(o=>({...o,reviewType:s.type,[s.type==="property"?"propertyId":s.type==="service"?"serviceId":"vendorId"]:s.id})),$(!0)},children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Write Review"]})]},`${s.type}-${s.id}-${t}`))})})]}),f.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6",children:[e.jsx(g,{variant:"outline",size:"sm",disabled:f.currentPage===1,onClick:()=>{r==="received"?w(f.currentPage-1):y(f.currentPage-1)},children:"Previous"}),e.jsxs("span",{className:"text-sm text-muted-foreground px-4",children:["Page ",f.currentPage," of ",f.totalPages]}),e.jsx(g,{variant:"outline",size:"sm",disabled:f.currentPage===f.totalPages,onClick:()=>{r==="received"?w(f.currentPage+1):y(f.currentPage+1)},children:"Next"})]})]})]})};export{ts as default};
