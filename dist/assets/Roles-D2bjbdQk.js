import{j as e}from"./ui-CMGlPv8M.js";import{d as ce,r as a}from"./router-02yfTqxa.js";import{G as $,u as de,Q as E,f as g,a0 as oe,a as r,b as c,c as d,e as o,S as h,d as P,B as m,U as T,V as me,W as xe,Y as ue,Z as he,$ as je,a2 as ge,ac as fe,ad as ve,ae as pe,ax as Ne,ay as O,af as U,t as B}from"./index-DGiQKbnC.js";import{P as be,a as ye,b as k,c as we,d as Se,e as Ae}from"./pagination-YbYwwe1g.js";import{D as Re}from"./DataTable-BoD-n14Z.js";import{S as Ce}from"./SearchFilter-DHKHpHz_.js";import{r as L}from"./roleService-CM7r2mAC.js";import{S as V}from"./square-pen-kV27aqSR.js";import{E as De}from"./ellipsis-v9J3hQEd.js";import{T as Pe}from"./trash-2-DzllJ_4S.js";import"./vendor-Dazix4UH.js";import"./table-B9xM5EYE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=$("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=$("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),We=()=>{const w=ce(),{isSuperAdmin:F}=de(),[S,z]=a.useState(""),[v,W]=a.useState("all"),[p,A]=a.useState([]),[H,_]=a.useState(!0),[n,f]=a.useState(1),[N,q]=a.useState(1),[R,I]=a.useState(0),[l,G]=a.useState(null),[i,Q]=a.useState(null),[Y,b]=a.useState(!1),[x,C]=a.useState(null),[D,M]=a.useState(!1),Z=async()=>{try{_(!0);const s={page:n,limit:10,search:S||void 0,isActive:v==="all"?void 0:v==="active"},t=await L.getRoles(s),u=t.data.roles.map(j=>({...j,pages:j.pages||[]}));A(u),q(t.data.pagination.totalPages),I(t.data.pagination.totalRoles);const y=u.find(j=>j.name.toLowerCase()==="superadmin"),re=u.find(j=>j.name.toLowerCase()==="subadmin");G(y||null),Q(re||null)}catch(s){console.error("Failed to fetch roles:",s)}finally{_(!1)}};a.useEffect(()=>{Z()},[n,S,v]);const J=s=>{z(s),f(1)},K=s=>{W(s),f(1)},X=s=>{f(s)},ee=()=>{n<N&&f(n+1)},se=()=>{n>1&&f(n-1)},te=async s=>{try{const t=await L.toggleRoleStatus(s._id);A(u=>u.map(y=>y._id===t.data.role._id?t.data.role:y)),B({title:"Success",description:`Role ${t.data.role.isActive?"activated":"deactivated"} successfully!`})}catch(t){console.error("Failed to toggle role status:",t)}},ae=async()=>{if(x)try{M(!0),await L.deleteRole(x._id),b(!1);const s=x._id;C(null),A(t=>t.filter(u=>u._id!==s)),I(t=>t-1),B({title:"Success",description:"Role deleted successfully!"})}catch(s){console.error("Failed to delete role:",s)}finally{M(!1)}},le=s=>{C(s),b(!0)},ie=s=>{const t=s.name.toLowerCase();return t==="superadmin"?e.jsxs(m,{variant:"destructive",className:"text-xs",children:[e.jsx(h,{className:"w-3 h-3 mr-1"}),"Super Admin"]}):t==="subadmin"?e.jsxs(m,{variant:"default",className:"text-xs bg-orange-500 hover:bg-orange-500/80",children:[e.jsx(h,{className:"w-3 h-3 mr-1"}),"Sub Admin"]}):s.isSystemRole?e.jsxs(m,{variant:"outline",className:"text-xs",children:[e.jsx(h,{className:"w-3 h-3 mr-1"}),"System"]}):null},ne=[{key:"name",label:"Role Name",render:s=>e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[s.name,ie(s)]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.description})]})},{key:"level",label:"Level",render:s=>e.jsxs(m,{variant:s.level>=8?"destructive":s.level>=5?"default":"secondary",children:["Level ",s.level]})},{key:"userCount",label:"Users",render:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.userCount||0})]})},{key:"isActive",label:"Status",render:s=>e.jsx(m,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})},{key:"actions",label:"Actions",render:s=>e.jsxs(fe,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(De,{className:"w-4 h-4"})]})}),e.jsxs(pe,{align:"end",className:"w-48",children:[e.jsx(Ne,{children:"Actions"}),e.jsx(O,{}),e.jsxs(U,{onClick:t=>{t.stopPropagation(),te(s)},disabled:s.isSystemRole&&s.isActive&&!F,className:"cursor-pointer",children:[s.isActive?e.jsx(Te,{className:"w-4 h-4 mr-2"}):e.jsx(ke,{className:"w-4 h-4 mr-2"}),s.isActive?"Deactivate":"Activate"]}),e.jsx(O,{}),e.jsxs(U,{onClick:t=>{t.stopPropagation(),le(s)},disabled:s.isSystemRole&&!F,className:"text-destructive focus:text-destructive cursor-pointer",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Delete Role"]})]})]})}];return H?e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx(E,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2 text-lg",children:"Loading roles..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Role Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage user roles and permissions"})]}),e.jsxs(g,{onClick:()=>w("/admin/roles/add"),className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Add New Role"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-3",children:[e.jsxs(r,{children:[e.jsx(c,{className:"pb-1",children:e.jsx(d,{className:"text-xs font-medium text-muted-foreground",children:"Total Roles"})}),e.jsx(o,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold",children:R})})]}),e.jsxs(r,{children:[e.jsx(c,{className:"pb-1",children:e.jsx(d,{className:"text-xs font-medium text-muted-foreground",children:"Active Roles"})}),e.jsx(o,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-500",children:p.filter(s=>s.isActive).length})})]}),e.jsxs(r,{children:[e.jsx(c,{className:"pb-1",children:e.jsx(d,{className:"text-xs font-medium text-muted-foreground",children:"System Roles"})}),e.jsx(o,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold text-blue-500",children:p.filter(s=>s.isSystemRole).length})})]}),e.jsxs(r,{children:[e.jsx(c,{className:"pb-1",children:e.jsx(d,{className:"text-xs font-medium text-muted-foreground",children:"Custom Roles"})}),e.jsx(o,{className:"pt-1",children:e.jsx("div",{className:"text-lg sm:text-xl font-bold text-purple-500",children:p.filter(s=>!s.isSystemRole).length})})]}),e.jsxs(r,{className:"border-destructive/20 bg-destructive/10",children:[e.jsx(c,{className:"pb-1",children:e.jsxs(d,{className:"text-xs font-medium text-destructive flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),"Super Admin"]})}),e.jsxs(o,{className:"pt-1",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-destructive",children:l?.userCount||0}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Level ",l?.level||10]})]})]}),e.jsxs(r,{className:"border-orange-500/20 bg-orange-500/10",children:[e.jsx(c,{className:"pb-1",children:e.jsxs(d,{className:"text-xs font-medium text-orange-600 flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),"Sub Admin"]})}),e.jsxs(o,{className:"pt-1",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-orange-500",children:i?.userCount||0}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Level ",i?.level||7]})]})]})]}),(l||i)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l&&e.jsxs(r,{className:"border-destructive/20 bg-gradient-to-br from-destructive/10 to-card",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(h,{className:"w-5 h-5"}),"Super Admin Role"]}),e.jsx(P,{children:l.description})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx(m,{variant:l.isActive?"default":"secondary",children:l.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Access Level:"}),e.jsxs(m,{variant:"destructive",children:["Level ",l.level]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Users:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-bold",children:l.userCount||0})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(g,{variant:"outline",size:"sm",className:"w-full",onClick:()=>w(`/admin/roles/edit/${l._id}`),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})]}),i&&e.jsxs(r,{className:"border-orange-500/20 bg-gradient-to-br from-orange-500/10 to-card",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(h,{className:"w-5 h-5"}),"Sub Admin Role"]}),e.jsx(P,{children:i.description})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx(m,{variant:i.isActive?"default":"secondary",children:i.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Access Level:"}),e.jsxs(m,{variant:"default",className:"bg-orange-500 hover:bg-orange-500/80",children:["Level ",i.level]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Users:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-bold",children:i.userCount||0})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs(g,{variant:"outline",size:"sm",className:"w-full",onClick:()=>w(`/admin/roles/edit/${i._id}`),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})]})]}),e.jsxs(r,{children:[e.jsxs(c,{children:[e.jsx(d,{children:"All Roles"}),e.jsxs(P,{children:[R," role",R!==1?"s":""," found"]})]}),e.jsxs(o,{children:[e.jsx(Ce,{searchTerm:S,onSearchChange:J,filterValue:v,onFilterChange:K,filterOptions:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],filterPlaceholder:"Filter by status"}),e.jsx(Re,{columns:ne,data:p.map(s=>({...s,id:s._id})),hideDefaultActions:!0}),N>1&&e.jsx("div",{className:"mt-6",children:e.jsx(be,{children:e.jsxs(ye,{children:[e.jsx(k,{children:e.jsx(we,{onClick:se,className:n===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:N},(s,t)=>t+1).map(s=>e.jsx(k,{children:e.jsx(Se,{onClick:()=>X(s),isActive:n===s,className:"cursor-pointer",children:s})},s)),e.jsx(k,{children:e.jsx(Ae,{onClick:ee,className:n===N?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]}),e.jsx(me,{open:Y,onOpenChange:b,children:e.jsxs(xe,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Delete Role"}),e.jsxs(je,{children:['Are you sure you want to delete the role "',x?.name,'"? This action cannot be undone.',x?.userCount&&x.userCount>0&&e.jsxs("p",{className:"text-destructive mt-2",children:["Warning: This role is currently assigned to ",x.userCount," user(s)."]})]})]}),e.jsxs(ge,{children:[e.jsx(g,{variant:"outline",onClick:()=>{b(!1),C(null)},disabled:D,children:"Cancel"}),e.jsx(g,{variant:"destructive",onClick:ae,disabled:D,children:D?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete Role"})]})]})})]})};export{We as default};
