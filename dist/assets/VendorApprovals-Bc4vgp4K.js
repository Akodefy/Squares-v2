import{j as e}from"./ui-CMGlPv8M.js";import{r as i}from"./router-02yfTqxa.js";import{a as c,b as o,c as m,n as I,e as d,C as T,E as y,o as F,J as U,I as $,r as q,s as H,v as J,w as z,x as h,f as v,M,z as W,q as G,V as X,W as Y,Y as Z,Z as K,$ as Q,B as S,a2 as ee,H as se,t as x}from"./index-DGiQKbnC.js";import{f as g,h as N}from"./apiUtils-Cw-_rb0N.js";import{D as te}from"./download-Dx_JF_-F.js";import"./vendor-Dazix4UH.js";const de=()=>{const[C,A]=i.useState([]),[u,E]=i.useState(null),[P,D]=i.useState(!0),[a,B]=i.useState(null),[V,p]=i.useState(!1),[n,R]=i.useState({status:"pending",search:"",page:1,limit:10}),[j,f]=i.useState(null),w=async()=>{try{const s=new URLSearchParams({page:n.page.toString(),limit:n.limit.toString(),status:n.status,search:n.search,sortBy:"submittedAt",sortOrder:"desc"}),r=await g(`/admin/vendor-approvals?${s}`),t=await N(r);A(t.data.vendors||[])}catch(s){console.error("Error fetching applications:",s),x({title:"Error",description:s instanceof Error?s.message:"Failed to fetch vendor applications",variant:"destructive"}),A([])}},b=async()=>{try{const s=await g("/admin/vendor-approval-stats"),r=await N(s);E(r.data||null)}catch(s){console.error("Error fetching stats:",s),x({title:"Error",description:s instanceof Error?s.message:"Failed to fetch statistics",variant:"destructive"}),E(null)}};i.useEffect(()=>{(async()=>{D(!0),await Promise.all([w(),b()]),D(!1)})()},[n.status,n.page,n.search]);const k=async s=>{const r=prompt("Enter approval notes (optional):");f("approve");try{const t=await g(`/admin/vendor-approvals/${s}/approve`,{method:"POST",body:JSON.stringify({approvalNotes:r,verificationLevel:"basic"})}),l=await N(t);if(!l.success)throw new Error(l.message||"Failed to approve vendor");x({title:"Success",description:"Vendor application approved successfully",variant:"default"}),w(),b(),p(!1)}catch(t){console.error("Error approving vendor:",t),x({title:"Error",description:t instanceof Error?t.message:"Failed to approve vendor application",variant:"destructive"})}finally{f(null)}},_=async s=>{const r=prompt("Enter rejection reason (required):");if(r){f("reject");try{const t=await g(`/admin/vendor-approvals/${s}/reject`,{method:"POST",body:JSON.stringify({rejectionReason:r,allowResubmission:!0})}),l=await N(t);if(!l.success)throw new Error(l.message||"Failed to reject vendor");x({title:"Success",description:"Vendor application rejected and vendor notified",variant:"default"}),w(),b(),p(!1)}catch(t){console.error("Error rejecting vendor:",t),x({title:"Error",description:t instanceof Error?t.message:"Failed to reject vendor application",variant:"destructive"})}finally{f(null)}}},L=({status:s})=>{const r={pending:{variant:"secondary",icon:I},approved:{variant:"default",icon:T},rejected:{variant:"destructive",icon:se},under_review:{variant:"default",icon:y}},t=r[s]||r.pending,l=t.icon;return e.jsxs(S,{variant:t.variant,children:[e.jsx(l,{className:"w-3 h-3 mr-1"}),s.replace("_"," ")]})},O=s=>new Date(s).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return P?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Vendor Applications"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Review and manage vendor applications"})]})}),u&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Pending"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:u.overview.pendingApplications})})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Approved"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:u.overview.approvedApplications})})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Under Review"}),e.jsx(y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:u.overview.underReviewApplications})})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Approval Rate"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(d,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[u.overview.approvalRate,"%"]})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx($,{placeholder:"Search by company name, email, or license number...",value:n.search,onChange:s=>R({...n,search:s.target.value,page:1}),className:"pl-10"})]}),e.jsxs(q,{value:n.status,onValueChange:s=>R({...n,status:s,page:1}),children:[e.jsx(H,{className:"w-full sm:w-48",children:e.jsx(J,{placeholder:"Filter by status"})}),e.jsxs(z,{children:[e.jsx(h,{value:"all",children:"All Status"}),e.jsx(h,{value:"pending",children:"Pending"}),e.jsx(h,{value:"under_review",children:"Under Review"}),e.jsx(h,{value:"approved",children:"Approved"}),e.jsx(h,{value:"rejected",children:"Rejected"})]})]})]}),e.jsx(c,{children:e.jsx(d,{className:"p-0",children:e.jsx("ul",{className:"divide-y divide-border",children:C.length===0?e.jsx("li",{className:"p-6 text-center text-muted-foreground",children:"No applications found matching your criteria"}):C.map(s=>e.jsx("li",{className:"p-6 hover:bg-muted/50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s.businessInfo.companyName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.user.profile.firstName," ",s.user.profile.lastName]})]}),e.jsx(L,{status:s.approval.status})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Submitted: ",O(s.approval.submittedAt)]}),e.jsxs("p",{children:["Documents: ",s.approval.submittedDocuments.length]})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{B(s),p(!0)},children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Review"]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:s.user.email})]}),s.user.profile.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:s.user.profile.phone})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:s.businessInfo.businessType})]})]})]})})},s._id))})})}),e.jsx(X,{open:V,onOpenChange:p,children:e.jsxs(Y,{className:"max-w-4xl",children:[e.jsxs(Z,{children:[e.jsx(K,{children:"Vendor Application Details"}),e.jsx(Q,{children:"Review and take action on the vendor application."})]}),a&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs(c,{children:[e.jsx(o,{children:e.jsx(m,{children:"Basic Information"})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Company Name:"})," ",a.businessInfo.companyName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Business Type:"})," ",a.businessInfo.businessType]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Contact Person:"})," ",a.user.profile.firstName," ",a.user.profile.lastName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Email:"})," ",a.user.email]}),a.businessInfo.licenseNumber&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"License Number:"})," ",a.businessInfo.licenseNumber]}),a.businessInfo.gstNumber&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"GST Number:"})," ",a.businessInfo.gstNumber]})]})})]}),e.jsxs(c,{children:[e.jsx(o,{children:e.jsx(m,{children:"Submitted Documents"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-2",children:a.approval.submittedDocuments.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.documentName}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.documentType.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.verified?e.jsx(S,{variant:"default",children:"Verified"}):e.jsx(S,{variant:"secondary",children:"Pending"}),e.jsx("a",{href:s.documentUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:e.jsx(te,{className:"h-4 w-4"})})]})]},r))})})]})]}),e.jsxs(ee,{children:[e.jsx(v,{variant:"outline",onClick:()=>p(!1),children:"Close"}),a?.approval.status==="pending"&&e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(v,{onClick:()=>_(a._id),disabled:j==="reject",variant:"destructive",children:j==="reject"?"Rejecting...":"Reject"}),e.jsx(v,{onClick:()=>k(a._id),disabled:j==="approve",variant:"default",children:j==="approve"?"Approving...":"Approve"})]})]})]})})]})};export{de as default};
