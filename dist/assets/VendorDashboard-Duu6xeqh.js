import{j as e}from"./ui-CMGlPv8M.js";import{r as i,L as M}from"./router-02yfTqxa.js";import{t as D,a3 as H,Q as O,f as u,aJ as P,E as I,ag as B,aB as z,z as U,av as W,aP as G,a as y,e as b,b as A,c as F,B as E,ac as J,ad as K,ae as Q,af as $,h as X,O as Y}from"./index-DGiQKbnC.js";import{R as _}from"./refresh-cw-bU1KP5oX.js";import{D as Z}from"./dollar-sign-CYcO9sIf.js";import{T as ee}from"./trending-up-DL-k5KbV.js";import{T as te}from"./trending-down-CKfKx8F3.js";import{R as se,L as re,C as ae,X as oe,Y as ne,T as ie,a as ce}from"./LineChart-VOkXkqOc.js";import{A as T}from"./activity-B_LWE1x-.js";import{E as le}from"./ellipsis-v9J3hQEd.js";import"./vendor-Dazix4UH.js";const de="https://api.akodefy.com/api";class he{async makeRequest(a,t={}){const m=`${de}${a}`,c={headers:{"Content-Type":"application/json",...t.headers},...t},l=localStorage.getItem("token");l&&(c.headers={...c.headers,Authorization:`Bearer ${l}`});try{const o=await fetch(m,c);if(!o.ok){const d=await o.json().catch(()=>({success:!1,message:`HTTP ${o.status}: ${o.statusText}`}));throw new Error(d.message||"An error occurred")}return await o.json()}catch(o){throw console.error("Vendor Dashboard API request failed:",o),o}}async getDashboardData(a={}){try{const t=new URLSearchParams;Object.entries(a).forEach(([l,o])=>{o!=null&&o!==""&&t.append(l,o.toString())});const m=`/vendors/dashboard${t.toString()?`?${t.toString()}`:""}`,c=await this.makeRequest(m);return c.success&&c.data?c.data:this.getEmptyDashboardData()}catch(t){return console.error("Failed to fetch vendor dashboard data:",t),this.getEmptyDashboardData()}}async getVendorStats(a="7d"){try{const t=await this.makeRequest(`/vendors/stats?dateRange=${a}`);if(t.success&&t.data)return t.data;throw new Error("Failed to fetch vendor stats")}catch(t){return console.error("Failed to fetch vendor stats:",t),{totalProperties:0,totalPropertiesChange:"+0",propertyViews:0,propertyViewsChange:"+0%",unreadMessages:0,totalMessages:0,messagesChange:"0 unread",totalRevenue:0,revenueChange:"+0%",conversionRate:0,conversionChange:"+0%",phoneCalls:0,phoneCallsChange:"+0%"}}}async getRecentProperties(a=6){try{const t=await this.makeRequest(`/vendors/properties/recent?limit=${a}`);if(t.success&&t.data)return t.data.properties;throw new Error("Failed to fetch recent properties")}catch(t){return console.error("Failed to fetch recent properties:",t),[]}}async getRecentLeads(a=10){try{const t=await this.makeRequest(`/vendors/leads/recent?limit=${a}`);if(t.success&&t.data)return t.data.leads;throw new Error("Failed to fetch recent leads")}catch(t){return console.error("Failed to fetch recent leads:",t),[]}}async getPerformanceData(a="7d"){try{const t=await this.makeRequest(`/vendors/performance?dateRange=${a}`);if(t.success&&t.data)return t.data.performance;throw new Error("Failed to fetch performance data")}catch(t){return console.error("Failed to fetch performance data:",t),[]}}async getVendorAnalytics(a="30d"){try{const t=await this.makeRequest(`/vendors/analytics?dateRange=${a}`);if(t.success&&t.data)return t.data;throw new Error("Failed to fetch vendor analytics")}catch(t){return console.error("Failed to fetch vendor analytics:",t),{monthlyPerformance:[],leadsBySource:[],propertyPerformance:[],topPerformingAreas:[]}}}async getNotifications(){try{const a=await this.makeRequest("/vendors/notifications");return a.success&&a.data?a.data.notifications:[]}catch(a){return console.error("Failed to fetch notifications:",a),[]}}async markNotificationAsRead(a){try{return(await this.makeRequest(`/vendors/notifications/${a}/read`,{method:"PATCH"})).success}catch(t){return console.error("Failed to mark notification as read:",t),!1}}async updateLeadStatus(a,t){try{return(await this.makeRequest(`/vendors/leads/${a}/status`,{method:"PATCH",body:JSON.stringify({status:t})})).success?(D({title:"Success",description:"Lead status updated successfully!"}),!0):!1}catch(m){const c=m instanceof Error?m.message:"Failed to update lead status";return D({title:"Error",description:c,variant:"destructive"}),!1}}formatPrice(a,t="₹"){return a>=1e7?`${t}${(a/1e7).toFixed(1)} Cr`:a>=1e5?`${t}${(a/1e5).toFixed(1)} L`:`${t}${a.toLocaleString("en-IN")}`}formatPercentageChange(a){const t=a.startsWith("+");return{value:a,isPositive:t}}getStatusColor(a){return{active:"bg-green-500",pending:"bg-yellow-500",sold:"bg-blue-500",rented:"bg-purple-500",inactive:"bg-gray-500",new:"bg-blue-500",contacted:"bg-yellow-500",qualified:"bg-orange-500",converted:"bg-green-500",lost:"bg-red-500"}[a]||"bg-gray-500"}getInterestColor(a){return{high:"text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900",medium:"text-yellow-600 bg-yellow-100 dark:text-yellow-400 dark:bg-yellow-900",low:"text-red-600 bg-red-100 dark:text-red-400 dark:bg-red-900"}[a]||"text-gray-600 bg-gray-100"}getEmptyDashboardData(){return{stats:{totalProperties:0,totalPropertiesChange:"+0",propertyViews:0,propertyViewsChange:"+0%",unreadMessages:0,totalMessages:0,messagesChange:"0 unread",totalRevenue:0,revenueChange:"+0%",conversionRate:0,conversionChange:"+0%",phoneCalls:0,phoneCallsChange:"+0%"},recentProperties:[],recentLeads:[],performanceData:[],analytics:{monthlyPerformance:[],leadsBySource:[],propertyPerformance:[],topPerformingAreas:[]},notifications:[]}}}const h=new he,me=(p={})=>{const{autoRefresh:a=!0,refreshInterval:t=3e4,enableRealtime:m=!0}=p,{isConnected:c}=H(),l=i.useRef(null),o=i.useRef({}),[d,N]=i.useState({stats:null,recentProperties:[],recentLeads:[],performanceData:[],notifications:[],isLoading:!0,error:null,lastUpdated:null}),n=i.useCallback(s=>{N(f=>({...f,...s,lastUpdated:new Date}))},[]),j=i.useCallback(async()=>{try{const s=await h.getVendorStats(o.current.dateRange||"7d");n({stats:s})}catch(s){console.error("Failed to refresh vendor stats:",s),n({error:s instanceof Error?s.message:"Failed to load stats"})}},[n]),v=i.useCallback(async()=>{try{const s=await h.getRecentProperties(6);n({recentProperties:s})}catch(s){console.error("Failed to refresh properties:",s)}},[n]),C=i.useCallback(async()=>{try{const s=await h.getRecentLeads(10);n({recentLeads:s})}catch(s){console.error("Failed to refresh leads:",s)}},[n]),k=i.useCallback(async()=>{try{const s=await h.getPerformanceData(o.current.dateRange||"7d");n({performanceData:s})}catch(s){console.error("Failed to refresh performance data:",s)}},[n]),L=i.useCallback(async()=>{try{const s=await h.getNotifications();n({notifications:s})}catch(s){console.error("Failed to refresh notifications:",s)}},[n]),g=i.useCallback(async()=>{n({isLoading:!0,error:null});try{const s=await h.getDashboardData(o.current);n({stats:s.stats,recentProperties:s.recentProperties,recentLeads:s.recentLeads,performanceData:s.performanceData,notifications:s.notifications,isLoading:!1,error:null})}catch(s){console.error("Failed to refresh dashboard data:",s),n({isLoading:!1,error:s instanceof Error?s.message:"Failed to load dashboard data"})}},[n]),R=i.useCallback(s=>{o.current={...o.current,...s},g()},[g]),V=i.useCallback(async s=>{try{await h.markNotificationAsRead(s)&&n({notifications:d.notifications.map(x=>x.id===s?{...x,isRead:!0}:x)})}catch(f){console.error("Failed to mark notification as read:",f),D({title:"Error",description:"Failed to mark notification as read",variant:"destructive"})}},[d.notifications,n]),w=i.useCallback(async(s,f)=>{try{await h.updateLeadStatus(s,f)&&(n({recentLeads:d.recentLeads.map(r=>r._id===s?{...r,status:f,updatedAt:new Date().toISOString()}:r)}),j())}catch(x){console.error("Failed to update lead status:",x)}},[d.recentLeads,n,j]);return i.useEffect(()=>{},[m,c]),i.useEffect(()=>{if(a&&t>0)return l.current=setInterval(()=>{d.isLoading||g()},t),()=>{l.current&&clearInterval(l.current)}},[a,t,g,d.isLoading]),i.useEffect(()=>{g()},[]),i.useEffect(()=>()=>{l.current&&clearInterval(l.current)},[]),[d,{refreshData:g,refreshStats:j,refreshProperties:v,refreshLeads:C,refreshPerformance:k,refreshNotifications:L,updateFilters:R,markNotificationAsRead:V,updateLeadStatus:w}]},Ce=()=>{const[p,a]=i.useState("7d"),[t,m]=i.useState("overview"),[c,l]=me({autoRefresh:!0,refreshInterval:3e4,enableRealtime:!0}),{stats:o,recentProperties:d,recentLeads:N,performanceData:n,notifications:j,isLoading:v,error:C,lastUpdated:k}=c,{refreshData:L,refreshStats:g,updateFilters:R,markNotificationAsRead:V,updateLeadStatus:w}=l;i.useEffect(()=>{R({dateRange:p})},[p,R]);const S=()=>{L(),D({title:"Dashboard Refreshed",description:"All data has been updated with the latest information."})};if(v&&!o)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading your dashboard..."})]})});if(C&&!o)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:C}),e.jsxs(u,{onClick:S,children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})});const s=j.filter(r=>!r.isRead).length,f=[{title:"Total Properties",value:o?.totalProperties||0,change:o?.totalPropertiesChange||"+0",icon:P,color:"text-blue-600"},{title:"Property Views",value:o?.propertyViews||0,change:o?.propertyViewsChange||"+0%",icon:I,color:"text-purple-600"},{title:"Messages",value:o?.totalMessages||0,change:o?.messagesChange||"0 unread",icon:B,color:"text-orange-600"},{title:"Total Revenue",value:h.formatPrice(o?.totalRevenue||0),change:o?.revenueChange||"+0%",icon:Z,color:"text-emerald-600"},{title:"Avg. Rating",value:o?.averageRating?o.averageRating.toFixed(1):"0.0",change:o?.ratingChange||"+0%",icon:z,color:"text-yellow-600"},{title:"Phone Calls",value:o?.phoneCalls||0,change:o?.phoneCallsChange||"+0%",icon:U,color:"text-green-600"}],x=n.length>0?n:[];return e.jsxs("div",{className:"space-y-6 mt-16",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Vendor Dashboard"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-muted-foreground",children:"Manage your properties and track your performance"}),k&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["• Last updated: ",k.toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",onClick:S,disabled:v,children:[e.jsx(_,{className:`w-4 h-4 mr-2 ${v?"animate-spin":""}`}),"Refresh"]}),s>0&&e.jsxs(u,{variant:"outline",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Notifications (",s,")"]}),e.jsx(M,{to:"/vendor/analytics",children:e.jsxs(u,{variant:"outline",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"View Analytics"]})}),e.jsx(M,{to:"/vendor/properties/add",children:e.jsxs(u,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Add Property"]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:f.map(r=>{const q=h.formatPercentageChange(r.change);return e.jsx(y,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r.title}),e.jsx("p",{className:"text-2xl font-bold",children:r.value}),e.jsxs("div",{className:"flex items-center mt-1",children:[q.isPositive?e.jsx(ee,{className:"h-4 w-4 text-green-500 mr-1"}):e.jsx(te,{className:"h-4 w-4 text-red-500 mr-1"}),e.jsx("p",{className:`text-xs ${q.isPositive?"text-green-500":"text-red-500"}`,children:r.change})]})]}),e.jsx(r.icon,{className:`h-8 w-8 ${r.color}`})]})})},r.title)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(y,{children:[e.jsx(A,{children:e.jsxs(F,{className:"flex items-center justify-between",children:["Views Performance",e.jsx("div",{className:"flex gap-2",children:["7d","30d","90d"].map(r=>e.jsx(u,{variant:p===r?"default":"ghost",size:"sm",onClick:()=>a(r),children:r},r))})]})}),e.jsx(b,{children:x.length>0?e.jsx(se,{width:"100%",height:300,children:e.jsxs(re,{data:x,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorViews",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]})}),e.jsx(ae,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",opacity:.3,vertical:!1}),e.jsx(oe,{dataKey:"date",stroke:"hsl(var(--muted-foreground))",fontSize:12,tickLine:!1,axisLine:!1}),e.jsx(ne,{stroke:"hsl(var(--muted-foreground))",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:r=>`${r}`}),e.jsx(ie,{contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px",boxShadow:"0 10px 15px -3px rgb(0 0 0 / 0.1)",color:"hsl(var(--popover-foreground))",fontSize:"13px"},labelStyle:{color:"hsl(var(--popover-foreground))",fontWeight:600,marginBottom:"4px"},cursor:{stroke:"hsl(var(--border))",strokeWidth:1}}),e.jsx(ce,{type:"monotone",dataKey:"views",stroke:"#10b981",strokeWidth:2.5,dot:!1,activeDot:{r:5,fill:"#10b981",stroke:"#fff",strokeWidth:2},name:"Views",fill:"url(#colorViews)"})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[300px] text-center",children:[e.jsx(T,{className:"w-16 h-16 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"No Performance Data"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"Performance metrics will appear here once your properties start receiving views."})]})})]}),e.jsxs(y,{children:[e.jsx(A,{children:e.jsxs(F,{className:"flex items-center justify-between",children:["Recent Activities",e.jsx(u,{variant:"ghost",size:"sm",children:"View All"})]})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:N.length>0?N.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.propertyTitle}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.message||"New inquiry"})]})]}),e.jsxs("div",{className:"text-right space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:"secondary",children:r.status||"new"}),e.jsxs(J,{children:[e.jsx(K,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm",children:e.jsx(le,{className:"h-4 w-4"})})}),e.jsxs(Q,{children:[e.jsx($,{onClick:()=>w(r._id,"contacted"),children:"Mark as Contacted"}),e.jsx($,{onClick:()=>w(r._id,"qualified"),children:"Mark as Qualified"}),e.jsx($,{onClick:()=>w(r._id,"converted"),children:"Mark as Converted"})]})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),new Date(r.createdAt).toLocaleDateString()]})]})]},r._id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(T,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No recent activities"}),e.jsx("p",{className:"text-sm",children:"Property inquiries and messages will appear here"})]})})})]})]}),e.jsxs(y,{children:[e.jsx(A,{children:e.jsxs(F,{className:"flex items-center justify-between",children:["Recent Properties",e.jsx(u,{variant:"ghost",size:"sm",children:"View All"})]})}),e.jsx(b,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.length>0?d.map(r=>e.jsxs(y,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.images[0]||"https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=300&h=200&fit=crop&auto=format",alt:r.title,className:"w-full h-32 object-cover"}),e.jsx(E,{className:`absolute top-2 right-2 ${h.getStatusColor(r.status)} text-white`,children:r.status}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(E,{variant:"secondary",className:"text-xs",children:r.listingType})})]}),e.jsxs(b,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold line-clamp-1",children:r.title}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2 flex items-center",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),r.location]}),e.jsx("p",{className:"text-lg font-bold text-primary mb-3",children:h.formatPrice(r.price,r.currency)}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),r.views," views"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Y,{className:"w-4 h-4 mr-1"}),r.favorites," favorites"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),r.rating||0," rating"]})]})]})]},r._id)):e.jsxs("div",{className:"col-span-full text-center py-8 text-muted-foreground",children:[e.jsx(P,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No properties found"}),e.jsx("p",{className:"text-sm",children:"Add your first property to get started"}),e.jsxs(u,{className:"mt-4",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Add Property"]})]})})})]})]})};export{Ce as default};
