import{j as e}from"./ui-CMGlPv8M.js";import{r as l,R as re,h as ie,L as f}from"./router-02yfTqxa.js";import{a1 as ne,R as ce,V as oe,W as de,Y as me,Z as ue,$ as xe,B as h,L as p,C as he,f as m,J as te,I as ae,r as G,s as Q,v as W,w as q,x as r,T as je,a2 as ge,aH as o,a0 as J,a as v,e as N,aS as Z,E as U,aB as H,h as fe,ac as pe,ad as ve,ae as Ne,af as L,U as be,t as O}from"./index-DGiQKbnC.js";import{A as K,a as X}from"./alert-CWbFXNNh.js";import{C as we}from"./circle-alert-YlyZ8R6H.js";import{C as Se}from"./camera-B-mROwV6.js";import{E as ye}from"./ellipsis-vertical-BahDdS2u.js";import{P as ee}from"./pen-line-BZo3xtAO.js";import{T as se}from"./trending-up-DL-k5KbV.js";import{T as Ce}from"./trash-2-DzllJ_4S.js";import{C as Pe}from"./calendar-CnnZ5ZoT.js";import"./vendor-Dazix4UH.js";const Te=({property:a,open:c,onOpenChange:j,onUpdateStatus:x})=>{const{toast:b}=ne(),[i,D]=l.useState(""),[w,S]=l.useState(""),[y,F]=l.useState(!1),[g,C]=l.useState(""),[_,B]=l.useState([]),[P,k]=l.useState(!1),[A,$]=l.useState(""),d=a?.status==="available",n=(()=>{if(!a)return null;const t=a.listingType||"sale";return t==="sale"?{value:"sold",label:"Mark as Sold",color:"bg-blue-500"}:t==="rent"?{value:"rented",label:"Mark as Rented",color:"bg-purple-500"}:t==="lease"?{value:"leased",label:"Mark as Leased",color:"bg-indigo-500"}:null})();l.useEffect(()=>{c&&d&&n&&M()},[c]);const M=async()=>{try{k(!0),console.log("[PropertyStatusDialog] Loading customers with role: customer");const t=await ce.getUsers({role:"customer",limit:100,status:"available"});console.log("[PropertyStatusDialog] Customer response:",t),t.success&&t.data?.users?(console.log(`[PropertyStatusDialog] Loaded ${t.data.users.length} customers`),B(t.data.users)):(console.error("[PropertyStatusDialog] Invalid response structure:",t),b({title:"Warning",description:"Failed to load customers properly.",variant:"default"}))}catch(t){console.error("[PropertyStatusDialog] Failed to load customers:",t),b({title:"Error",description:"Failed to load customers.",variant:"destructive"})}finally{k(!1)}},R=_.filter(t=>{const u=A.toLowerCase(),I=`${t.profile?.firstName||""} ${t.profile?.lastName||""}`.toLowerCase(),Y=t.email?.toLowerCase()||"",le=t.profile?.phone||"";return I.includes(u)||Y.includes(u)||le.includes(u)});re.useEffect(()=>{a&&c&&(D(""),S(""),C(""),$(""))},[a,c]);const V=()=>{n&&D(n.value)},z=async()=>{if(!(!a||!i)){if(!g){b({title:"Customer Required",description:`Please select a customer to assign this ${i} property to.`,variant:"destructive"});return}F(!0);try{await x(a._id,i,g,w.trim()||void 0),j(!1)}catch(t){console.error("Failed to update status:",t)}finally{F(!1)}}},E=t=>{switch(t){case"active":return"bg-green-500";case"pending":return"bg-yellow-500";case"sold":return"bg-blue-500";case"rented":return"bg-purple-500";case"leased":return"bg-indigo-500";case"rejected":return"bg-red-500";default:return"bg-gray-500"}},s=t=>{switch(t){case"active":return"Active";case"pending":return"Pending Approval";case"sold":return"Sold";case"rented":return"Rented";case"leased":return"Leased";case"rejected":return"Rejected";default:return t.charAt(0).toUpperCase()+t.slice(1)}};return e.jsx(oe,{open:c,onOpenChange:j,children:e.jsxs(de,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsx(ue,{children:"Update Property Status"}),e.jsx(xe,{children:a?.title}),a?.listingType&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Listing Type: ",e.jsx(h,{variant:"outline",className:"ml-1",children:a.listingType})]})]}),"        ",e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Current Status"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(h,{className:`${E(a?.status||"")} text-white`,children:s(a?.status||"")})})]}),!d&&e.jsxs(K,{children:[e.jsx(we,{className:"h-4 w-4"}),e.jsxs(X,{children:["This property is not yet approved by admin. You can only update the status to ",n?.label.toLowerCase()," after admin approval."]})]}),a?.status==="sold"||a?.status==="rented"||a?.status==="leased"?e.jsxs(K,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsxs(X,{children:["This property has already been marked as ",s(a.status).toLowerCase(),"."]})]}):i===""?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Action"}),e.jsx(m,{onClick:V,disabled:!d||!n,className:`w-full ${n?.color||"bg-primary"} hover:opacity-90 text-white`,size:"lg",children:n?.label||"Update Status"}),!d&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Button will be enabled once admin approves your property"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"customer-search",children:"Search Customer"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(ae,{id:"customer-search",placeholder:"Search by name, email, or phone...",value:A,onChange:t=>$(t.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"customer-select",children:"Assign To Customer *"}),P?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading customers..."}):e.jsxs(G,{value:g,onValueChange:C,children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"Select customer who bought/rented this property"})}),e.jsx(q,{children:R.length===0?e.jsx("div",{className:"p-2 text-sm text-muted-foreground text-center",children:A?"No customers found":"No customers available"}):R.map(t=>e.jsx(r,{value:t._id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium",children:[t.profile?.firstName," ",t.profile?.lastName]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.email," ",t.profile?.phone&&`• ${t.profile.phone}`]})]})},t._id))})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This property will be added to the selected customer's portfolio"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"reason",children:"Additional Notes (Optional)"}),e.jsx(je,{id:"reason",placeholder:"Add any notes about this transaction...",value:w,onChange:t=>S(t.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Status Change Preview"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:`${E(a?.status||"")} text-white`,children:s(a?.status||"")}),e.jsx("span",{className:"text-muted-foreground",children:"→"}),e.jsx(h,{className:`${n?.color||"bg-gray-500"} text-white`,children:s(i)})]})]})]})]}),e.jsxs(ge,{children:[e.jsx(m,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),i&&e.jsx(m,{onClick:z,disabled:y||!g,className:`${n?.color||"bg-primary"} hover:opacity-90 text-white`,children:y?"Updating...":`Confirm ${n?.label}`})]})]})})},Be=()=>{const[a]=ie(),[c,j]=l.useState(a.get("search")||""),[x,b]=l.useState("all"),[i,D]=l.useState("all"),[w,S]=l.useState(!0),[y,F]=l.useState([]),[g,C]=l.useState(!1),[_,B]=l.useState(null),[P,k]=l.useState({totalProperties:0,totalViews:0,totalFavorites:0,averageRating:0}),[A,$]=l.useState({currentPage:1,totalPages:1,totalProperties:0,hasNextPage:!1,hasPrevPage:!1});l.useEffect(()=>{d(),T()},[]),l.useEffect(()=>{const s=a.get("search");s&&j(s)},[a]),l.useEffect(()=>{d()},[c,x,i]);const d=async()=>{try{S(!0);const s={page:1,limit:10,...c&&{search:c},...x!=="all"&&{status:x},...i!=="all"&&{propertyType:i}},t=await o.getVendorProperties(s);F(t.data.properties),$(t.data.pagination)}catch(s){console.error("Failed to load properties:",s)}finally{S(!1)}},T=async()=>{try{const s=await o.getVendorPropertyStats();k(s)}catch(s){console.error("Failed to load stats:",s)}},n=async s=>{if(window.confirm("Are you sure you want to delete this property?"))try{await o.deleteProperty(s),d(),T()}catch(t){console.error("Failed to delete property:",t)}},M=async(s,t)=>{try{await o.togglePropertyFeatured(s,!t),d(),T()}catch(u){console.error("Failed to toggle featured status:",u)}},R=async(s,t,u,I)=>{try{u&&(t==="sold"||t==="rented"||t==="leased")?(await o.assignPropertyToCustomer(s,u,t,I),O({title:"Success",description:`Property ${t} and assigned to customer successfully!`})):(await o.togglePropertyStatus(s,t),O({title:"Success",description:`Property status updated to ${t}!`})),d(),T()}catch(Y){console.error("Failed to update property status:",Y),O({title:"Error",description:"Failed to update property status",variant:"destructive"})}},V=s=>{B(s),C(!0)},z=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),E=s=>{const t=[];return s.address.locationName&&t.push(s.address.locationName),s.address.city&&t.push(s.address.city),s.address.state&&t.push(s.address.state),t.join(", ")||"Location not specified"};return w?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading properties..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Properties"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and track your property listings"})]}),e.jsx(f,{to:"/vendor/properties/add",children:e.jsxs(m,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Add Property"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Properties"}),e.jsx("p",{className:"text-2xl font-bold",children:P.totalProperties})]}),e.jsx(Z,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Views"}),e.jsx("p",{className:"text-2xl font-bold",children:P.totalViews.toLocaleString()})]}),e.jsx(U,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg. Rating"}),e.jsx("p",{className:"text-2xl font-bold",children:P.averageRating.toFixed(1)})]}),e.jsx(H,{className:"h-8 w-8 text-orange-600"})]})})})]}),e.jsx(v,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(ae,{placeholder:"Search properties...",value:c,onChange:s=>j(s.target.value),className:"pl-10"})]}),e.jsxs(G,{value:x,onValueChange:b,children:[e.jsx(Q,{className:"w-full sm:w-40",children:e.jsx(W,{placeholder:"Status"})}),e.jsxs(q,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"available",children:"Available"}),e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"sold",children:"Sold"}),e.jsx(r,{value:"rented",children:"Rented"})]})]}),e.jsxs(G,{value:i,onValueChange:D,children:[e.jsx(Q,{className:"w-full sm:w-40",children:e.jsx(W,{placeholder:"Type"})}),e.jsxs(q,{children:[e.jsx(r,{value:"all",children:"All Types"}),e.jsx(r,{value:"apartment",children:"Apartment"}),e.jsx(r,{value:"house",children:"House"}),e.jsx(r,{value:"villa",children:"Villa"}),e.jsx(r,{value:"plot",children:"Plot"}),e.jsx(r,{value:"land",children:"Land"}),e.jsx(r,{value:"commercial",children:"Commercial"}),e.jsx(r,{value:"office",children:"Office"}),e.jsx(r,{value:"pg",children:"PG (Paying Guest)"})]})]})]})})}),e.jsx("div",{className:"space-y-4",children:y.map(s=>e.jsx(v,{className:"overflow-hidden",children:e.jsx(N,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-64 h-48 lg:h-auto bg-muted relative",children:[s.images&&s.images.length>0?e.jsx("img",{src:o.getPrimaryImage(s),alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/20 to-transparent flex items-center justify-center",children:e.jsx(Se,{className:"w-12 h-12 text-muted-foreground"})}),e.jsxs("div",{className:"absolute top-3 left-3 flex gap-2",children:[e.jsx(h,{className:`${o.getStatusColor(s.status)} text-white`,children:o.getStatusText(s.status)}),s.featured&&e.jsx(h,{variant:"secondary",children:"Featured"}),s.verified&&e.jsx(h,{className:"bg-green-600 text-white",children:"Verified"})]}),s.images&&s.images.length>0&&e.jsxs("div",{className:"absolute bottom-3 left-3 bg-black/70 text-white px-2 py-1 rounded text-sm",children:[s.images.length," ",s.images.length===1?"photo":"photos"]})]}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-1",children:s.title}),e.jsxs("p",{className:"text-muted-foreground flex items-center mb-2",children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),E(s)]}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:o.formatPrice(s.price,s.listingType)})]}),e.jsxs(pe,{children:[e.jsx(ve,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",children:e.jsx(ye,{className:"w-4 h-4"})})}),e.jsxs(Ne,{align:"end",children:[e.jsx(L,{asChild:!0,children:e.jsxs(f,{to:`/vendor/properties/details/${s._id}`,children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"View Details"]})}),e.jsx(L,{asChild:!0,children:e.jsxs(f,{to:`/vendor/properties/edit/${s._id}`,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Edit Property"]})}),e.jsxs(L,{onClick:()=>M(s._id,s.featured),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),s.featured?"Unfeature":"Promote"]}),s.status==="available"&&e.jsxs(L,{onClick:()=>V(s),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),s.listingType==="sale"?"Mark as Sold":s.listingType==="rent"?"Mark as Rented":"Mark as Leased"]}),e.jsxs(L,{className:"text-red-600",onClick:()=>n(s._id),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[s.bedrooms>0&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:s.bedrooms})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bathrooms"}),e.jsx("p",{className:"font-semibold",children:s.bathrooms})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Area"}),e.jsx("p",{className:"font-semibold",children:o.formatArea(s.area)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx("p",{className:"font-semibold capitalize",children:s.type})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground mb-4",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),s.views," views"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),s.favorites||0," favorites"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(H,{className:"w-4 h-4 mr-1 fill-current text-yellow-500"}),s.averageRating?.toFixed(1)||"0.0"," rating"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(Pe,{className:"w-4 h-4 mr-1"}),"Listed ",z(s.createdAt)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{to:`/vendor/properties/details/${s._id}`,children:e.jsxs(m,{size:"sm",variant:"outline",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"View Details"]})}),e.jsx(f,{to:`/vendor/properties/edit/${s._id}`,children:e.jsxs(m,{size:"sm",variant:"outline",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Edit"]})}),e.jsxs(m,{size:"sm",onClick:()=>M(s._id,s.featured),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),s.featured?"Unfeature":"Promote"]}),s.status==="available"&&e.jsx(m,{size:"sm",variant:"outline",onClick:()=>V(s),children:s.listingType==="sale"?"Mark as Sold":s.listingType==="rent"?"Mark as Rented":"Mark as Leased"})]})]})]})})},s._id))}),y.length===0&&!w&&e.jsx(v,{children:e.jsxs(N,{className:"p-12 text-center",children:[e.jsx(Z,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No properties found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:c||x!=="all"||i!=="all"?"No properties match your search criteria":"You haven't added any properties yet"}),e.jsx(f,{to:"/vendor/properties/add",children:e.jsxs(m,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Add Your First Property"]})})]})}),e.jsx(Te,{property:_,open:g,onOpenChange:C,onUpdateStatus:R})]})};export{Be as default};
